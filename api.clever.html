
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>api.clever package &#8212; Library Simplified Circulation Manager  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="api.lcp package" href="api.lcp.html" />
    <link rel="prev" title="api.admin.controller package" href="api.admin.controller.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="api-clever-package">
<h1>api.clever package<a class="headerlink" href="#api-clever-package" title="Permalink to this heading">¶</a></h1>
<section id="module-api.clever">
<span id="module-contents"></span><h2>Module contents<a class="headerlink" href="#module-api.clever" title="Permalink to this heading">¶</a></h2>
<dl class="py attribute">
<dt class="sig sig-object py" id="api.clever.AuthenticationProvider">
<span class="sig-prename descclassname"><span class="pre">api.clever.</span></span><span class="sig-name descname"><span class="pre">AuthenticationProvider</span></span><a class="headerlink" href="#api.clever.AuthenticationProvider" title="Permalink to this definition">¶</a></dt>
<dd><p>alias of <a class="reference internal" href="#api.clever.CleverAuthenticationAPI" title="api.clever.CleverAuthenticationAPI"><code class="xref py py-class docutils literal notranslate"><span class="pre">CleverAuthenticationAPI</span></code></a></p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="api.clever.CleverAuthenticationAPI">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">api.clever.</span></span><span class="sig-name descname"><span class="pre">CleverAuthenticationAPI</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">library</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">integration</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">analytics</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/api/clever.html#CleverAuthenticationAPI"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#api.clever.CleverAuthenticationAPI" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="api.html#api.authenticator.OAuthAuthenticationProvider" title="api.authenticator.OAuthAuthenticationProvider"><code class="xref py py-class docutils literal notranslate"><span class="pre">OAuthAuthenticationProvider</span></code></a></p>
<dl class="py attribute">
<dt class="sig sig-object py" id="api.clever.CleverAuthenticationAPI.CLEVER_API_BASE_URL">
<span class="sig-name descname"><span class="pre">CLEVER_API_BASE_URL</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'https://api.clever.com'</span></em><a class="headerlink" href="#api.clever.CleverAuthenticationAPI.CLEVER_API_BASE_URL" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="api.clever.CleverAuthenticationAPI.CLEVER_API_VERSION">
<span class="sig-name descname"><span class="pre">CLEVER_API_VERSION</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'3.0'</span></em><a class="headerlink" href="#api.clever.CleverAuthenticationAPI.CLEVER_API_VERSION" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="api.clever.CleverAuthenticationAPI.CLEVER_API_VERSIONED_URL">
<span class="sig-name descname"><span class="pre">CLEVER_API_VERSIONED_URL</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'https://api.clever.com/v3.0'</span></em><a class="headerlink" href="#api.clever.CleverAuthenticationAPI.CLEVER_API_VERSIONED_URL" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="api.clever.CleverAuthenticationAPI.CLEVER_TOKEN_URL">
<span class="sig-name descname"><span class="pre">CLEVER_TOKEN_URL</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'https://clever.com/oauth/tokens'</span></em><a class="headerlink" href="#api.clever.CleverAuthenticationAPI.CLEVER_TOKEN_URL" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="api.clever.CleverAuthenticationAPI.DESCRIPTION">
<span class="sig-name descname"><span class="pre">DESCRIPTION</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">l'</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">An</span> <span class="pre">authentication</span> <span class="pre">service</span> <span class="pre">for</span> <span class="pre">Open</span> <span class="pre">eBooks</span> <span class="pre">that</span> <span class="pre">uses</span> <span class="pre">Clever</span> <span class="pre">as</span> <span class="pre">an</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">OAuth</span> <span class="pre">provider.'</span></em><a class="headerlink" href="#api.clever.CleverAuthenticationAPI.DESCRIPTION" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="api.clever.CleverAuthenticationAPI.EXTERNAL_AUTHENTICATE_URL">
<span class="sig-name descname"><span class="pre">EXTERNAL_AUTHENTICATE_URL</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'https://clever.com/oauth/authorize?response_type=code&amp;client_id=%(client_id)s&amp;redirect_uri=%(oauth_callback_url)s&amp;state=%(state)s'</span></em><a class="headerlink" href="#api.clever.CleverAuthenticationAPI.EXTERNAL_AUTHENTICATE_URL" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="api.clever.CleverAuthenticationAPI.LIBRARY_SETTINGS">
<span class="sig-name descname"><span class="pre">LIBRARY_SETTINGS</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">[]</span></em><a class="headerlink" href="#api.clever.CleverAuthenticationAPI.LIBRARY_SETTINGS" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="api.clever.CleverAuthenticationAPI.LOGIN_BUTTON_IMAGE">
<span class="sig-name descname"><span class="pre">LOGIN_BUTTON_IMAGE</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'CleverLoginButton280.png'</span></em><a class="headerlink" href="#api.clever.CleverAuthenticationAPI.LOGIN_BUTTON_IMAGE" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="api.clever.CleverAuthenticationAPI.NAME">
<span class="sig-name descname"><span class="pre">NAME</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'Clever'</span></em><a class="headerlink" href="#api.clever.CleverAuthenticationAPI.NAME" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="api.clever.CleverAuthenticationAPI.SETTINGS">
<span class="sig-name descname"><span class="pre">SETTINGS</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">[{'key':</span> <span class="pre">'username',</span> <span class="pre">'label':</span> <span class="pre">l'Client</span> <span class="pre">ID',</span> <span class="pre">'required':</span> <span class="pre">True},</span> <span class="pre">{'key':</span> <span class="pre">'password',</span> <span class="pre">'label':</span> <span class="pre">l'Client</span> <span class="pre">Secret',</span> <span class="pre">'required':</span> <span class="pre">True},</span> <span class="pre">{'key':</span> <span class="pre">'token_expiration_days',</span> <span class="pre">'type':</span> <span class="pre">'number',</span> <span class="pre">'label':</span> <span class="pre">l'Days</span> <span class="pre">until</span> <span class="pre">OAuth</span> <span class="pre">token</span> <span class="pre">expires'}]</span></em><a class="headerlink" href="#api.clever.CleverAuthenticationAPI.SETTINGS" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="api.clever.CleverAuthenticationAPI.SUPPORTED_USER_TYPES">
<span class="sig-name descname"><span class="pre">SUPPORTED_USER_TYPES</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">['student',</span> <span class="pre">'teacher']</span></em><a class="headerlink" href="#api.clever.CleverAuthenticationAPI.SUPPORTED_USER_TYPES" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="api.clever.CleverAuthenticationAPI.TOKEN_DATA_SOURCE_NAME">
<span class="sig-name descname"><span class="pre">TOKEN_DATA_SOURCE_NAME</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'Clever'</span></em><a class="headerlink" href="#api.clever.CleverAuthenticationAPI.TOKEN_DATA_SOURCE_NAME" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="api.clever.CleverAuthenticationAPI.TOKEN_TYPE">
<span class="sig-name descname"><span class="pre">TOKEN_TYPE</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'Clever</span> <span class="pre">token'</span></em><a class="headerlink" href="#api.clever.CleverAuthenticationAPI.TOKEN_TYPE" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="api.clever.CleverAuthenticationAPI.URI">
<span class="sig-name descname"><span class="pre">URI</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'http://librarysimplified.org/terms/auth/clever'</span></em><a class="headerlink" href="#api.clever.CleverAuthenticationAPI.URI" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="api.clever.CleverAuthenticationAPI.oauth_callback">
<span class="sig-name descname"><span class="pre">oauth_callback</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">_db</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">code</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/api/clever.html#CleverAuthenticationAPI.oauth_callback"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#api.clever.CleverAuthenticationAPI.oauth_callback" title="Permalink to this definition">¶</a></dt>
<dd><p>Verify the incoming parameters with the OAuth provider. Exchange
the authorization code for an access token. Create or look up
appropriate database records.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>code</strong> – The authorization code generated by the
authorization server, as per section 4.1.2 of RFC 6749. This
method will exchange the authorization code for an access
token.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A ProblemDetail if there’s a problem. Otherwise, a
3-tuple (Credential, Patron, PatronData). The Credential
contains the access token provided by the OAuth provider. The
Patron object represents the authenticated Patron, and the
PatronData object includes information about the patron
obtained from the OAuth provider which cannot be stored in the
circulation manager’s database, but which should be passed on
to the client.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="api.clever.CleverAuthenticationAPI.remote_exchange_code_for_bearer_token">
<span class="sig-name descname"><span class="pre">remote_exchange_code_for_bearer_token</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">_db</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">code</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/api/clever.html#CleverAuthenticationAPI.remote_exchange_code_for_bearer_token"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#api.clever.CleverAuthenticationAPI.remote_exchange_code_for_bearer_token" title="Permalink to this definition">¶</a></dt>
<dd><p>Ask the OAuth provider to convert a code (passed in to the OAuth
callback) into a bearer token.</p>
<p>We can use the bearer token to act on behalf of a specific
patron. It also gives us confidence that the patron
authenticated correctly with Clever.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>A ProblemDetail if there’s a problem; otherwise, the
bearer token.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="api.clever.CleverAuthenticationAPI.remote_patron_lookup">
<span class="sig-name descname"><span class="pre">remote_patron_lookup</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">token</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/api/clever.html#CleverAuthenticationAPI.remote_patron_lookup"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#api.clever.CleverAuthenticationAPI.remote_patron_lookup" title="Permalink to this definition">¶</a></dt>
<dd><p>Use a bearer token for a patron to look up that patron’s Clever
record through the Clever API.</p>
<p>This is the only method that has access to a patron’s personal
information as provided by Clever. Here’s an inventory of the
information we process and what happens to it:</p>
<ul>
<li><p>The Clever ‘id’ associated with this patron is passed out of
this method through the PatronData object, and persisted to
two database fields: ‘patrons.external_identifier’ and
‘patrons.authorization_identifier’.</p>
<p>As far as we know, the Clever ID is an opaque reference
which uniquely identifies a given patron but contains no
personal information about them.</p>
</li>
<li><p>If the patron is a student, their grade level
(“Kindergarten” through “12”) is converted into an Open
eBooks patron type (“E” for “Early Grades”, “M” for “Middle
Grades”, or “H” for “High School”). This is stored in the
PatronData object returned from this method, and persisted
to the database field ‘patrons.external_type’. If the patron
is not a student, their Open eBooks patron type is set to
“A” for “All Access”).</p>
<p>This system does not track a patron’s grade level or store
it in the database. Only the coarser-grained Open eBooks
patron type is tracked. This is used to show age-appropriate
books to the patron.</p>
</li>
<li><p>The internal Clever ID of the patron’s school is used to
make a _second_ Clever API request to get information about
the school. From that, we get the school’s NCES ID, which we
cross-check against data we’ve gathered separately to
validate the school’s Title I status. The school ID and NCES
ID are not stored in the PatronData object or persisted to
the database. Any patron who ends up in the database is
presumed to have passed this check.</p></li>
</ul>
<p>To summarize, an opaque ID associated with the patron is
persisted to the database, as is a coarse-grained indicator of
the patron’s age. No other information about the patron makes
it out of this method.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>A ProblemDetail if there’s a problem. Otherwise, a PatronData
with the data listed above.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="api.clever.external_type_from_clever_grade">
<span class="sig-prename descclassname"><span class="pre">api.clever.</span></span><span class="sig-name descname"><span class="pre">external_type_from_clever_grade</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">grade</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/api/clever.html#external_type_from_clever_grade"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#api.clever.external_type_from_clever_grade" title="Permalink to this definition">¶</a></dt>
<dd><p>Maps a ‘grade’ value returned by the Clever API for student users to an external_type</p>
</dd></dl>

</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">Library Simplified Circulation Manager</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="modules.html">circulation</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="api.html">api package</a></li>
<li class="toctree-l2"><a class="reference internal" href="app.html">app module</a></li>
<li class="toctree-l2"><a class="reference internal" href="core.html">core package</a></li>
<li class="toctree-l2"><a class="reference internal" href="scripts.html">scripts module</a></li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  <li><a href="modules.html">circulation</a><ul>
  <li><a href="api.html">api package</a><ul>
      <li>Previous: <a href="api.admin.controller.html" title="previous chapter">api.admin.controller package</a></li>
      <li>Next: <a href="api.lcp.html" title="next chapter">api.lcp package</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, The New York Public Library, Astor, Lenox, and Tilden Foundations.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 5.0.0b1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="_sources/api.clever.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>