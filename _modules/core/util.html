
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>core.util &#8212; Library Simplified Circulation Manager  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for core.util</h1><div class="highlight"><pre>
<span></span><span class="c1"># encoding: utf-8</span>
<span class="sd">&quot;&quot;&quot;Miscellaneous utilities&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>

<span class="kn">import</span> <span class="nn">flask_sqlalchemy_session</span>
<span class="kn">import</span> <span class="nn">sqlalchemy</span>
<span class="kn">from</span> <span class="nn">money</span> <span class="kn">import</span> <span class="n">Money</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">distinct</span><span class="p">,</span> <span class="n">select</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.sql.functions</span> <span class="kn">import</span> <span class="n">func</span>

<span class="c1"># For backwards compatibility, import items that were moved to </span>
<span class="c1"># languages.py</span>
<span class="kn">from</span> <span class="nn">.languages</span> <span class="kn">import</span> <span class="n">LanguageCodes</span><span class="p">,</span> <span class="n">LookupTable</span>


<div class="viewcode-block" id="batch"><a class="viewcode-back" href="../../core.util.html#core.util.batch">[docs]</a><span class="k">def</span> <span class="nf">batch</span><span class="p">(</span><span class="n">iterable</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Split up `iterable` into batches of size `size`.&quot;&quot;&quot;</span>

    <span class="n">l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">iterable</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">start</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
        <span class="k">yield</span> <span class="n">iterable</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="nb">min</span><span class="p">(</span><span class="n">start</span><span class="o">+</span><span class="n">size</span><span class="p">,</span> <span class="n">l</span><span class="p">)]</span></div>

<div class="viewcode-block" id="fast_query_count"><a class="viewcode-back" href="../../core.util.html#core.util.fast_query_count">[docs]</a><span class="k">def</span> <span class="nf">fast_query_count</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Counts the results of a query without using super-slow subquery&quot;&quot;&quot;</span>

    <span class="n">statement</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">selectable</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">statement</span><span class="o">.</span><span class="n">froms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">distinct_columns</span> <span class="o">=</span> <span class="n">statement</span><span class="o">.</span><span class="n">_distinct_on</span>
    <span class="n">new_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">func</span><span class="o">.</span><span class="n">count</span><span class="p">()]</span>

    <span class="k">if</span> <span class="n">statement</span><span class="o">.</span><span class="n">_distinct</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">distinct_columns</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
        <span class="c1"># When using distinct to select from the db, the distinct</span>
        <span class="c1"># columns need to be incorporated into the count itself.</span>
        <span class="n">new_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">func</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">distinct</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="o">*</span><span class="n">distinct_columns</span><span class="p">)))]</span>

    <span class="n">count_q</span> <span class="o">=</span> <span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">with_only_columns</span><span class="p">(</span><span class="n">new_columns</span><span class="p">)</span><span class="o">.</span><span class="n">select_from</span><span class="p">(</span><span class="n">table</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">count</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">count_q</span><span class="p">)</span><span class="o">.</span><span class="n">scalar</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">_limit_clause</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">query</span><span class="o">.</span><span class="n">_limit_clause</span><span class="o">.</span><span class="n">value</span> <span class="o">&lt;</span> <span class="n">count</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">query</span><span class="o">.</span><span class="n">_limit_clause</span><span class="o">.</span><span class="n">value</span>

    <span class="k">return</span> <span class="n">count</span></div>

<div class="viewcode-block" id="slugify"><a class="viewcode-back" href="../../core.util.html#core.util.slugify">[docs]</a><span class="k">def</span> <span class="nf">slugify</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">length_limit</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Takes a string and turns it into a slug.</span>

<span class="sd">    :Example:</span>

<span class="sd">    &gt;&gt;&gt; slugify(&#39;Some (???) Title Somewhere&#39;)</span>
<span class="sd">    some-title-somewhere</span>
<span class="sd">    &gt;&gt;&gt; slugify(&#39;Sly &amp; the Family Stone&#39;)</span>
<span class="sd">    sly-and-the-family-stone</span>
<span class="sd">    &gt;&gt;&gt; slugify(&#39;Happy birthday!&#39;, length_limit=4)</span>
<span class="sd">    happ</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">slug</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;[.!@#</span><span class="se">\&#39;</span><span class="s1">$,?\(\)]&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
    <span class="n">slug</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;&amp;&#39;</span><span class="p">,</span> <span class="s1">&#39; and &#39;</span><span class="p">,</span> <span class="n">slug</span><span class="p">)</span>
    <span class="n">slug</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39; {2,}&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">slug</span><span class="p">)</span>

    <span class="n">slug</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">slug</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">))</span>
    <span class="k">while</span> <span class="s1">&#39;--&#39;</span> <span class="ow">in</span> <span class="n">slug</span><span class="p">:</span>
        <span class="n">slug</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">slug</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">length_limit</span><span class="p">:</span>
        <span class="n">slug</span> <span class="o">=</span> <span class="n">slug</span><span class="p">[:</span><span class="n">length_limit</span><span class="p">]</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">slug</span><span class="p">)</span></div>


<div class="viewcode-block" id="MetadataSimilarity"><a class="viewcode-back" href="../../core.util.html#core.util.MetadataSimilarity">[docs]</a><span class="k">class</span> <span class="nc">MetadataSimilarity</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Estimate how similar two bits of metadata are.&quot;&quot;&quot;</span>

    <span class="n">SEPARATOR</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;\W&quot;</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_wordbag</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_wordlist</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_wordlist</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">SEPARATOR</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span>

<div class="viewcode-block" id="MetadataSimilarity.histogram"><a class="viewcode-back" href="../../core.util.html#core.util.MetadataSimilarity.histogram">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">histogram</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">strings</span><span class="p">,</span> <span class="n">stopwords</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a histogram of word frequencies across the given list of</span>
<span class="sd">        strings.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">histogram</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
        <span class="n">words</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">string</span> <span class="ow">in</span> <span class="n">strings</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_wordlist</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">stopwords</span> <span class="ow">or</span> <span class="n">word</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stopwords</span><span class="p">:</span>
                    <span class="n">histogram</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">words</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">normalize_histogram</span><span class="p">(</span><span class="n">histogram</span><span class="p">,</span> <span class="n">words</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetadataSimilarity.normalize_histogram"><a class="viewcode-back" href="../../core.util.html#core.util.MetadataSimilarity.normalize_histogram">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">normalize_histogram</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">histogram</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">total</span><span class="p">:</span>
            <span class="n">total</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">histogram</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="n">total</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">total</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">histogram</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="n">histogram</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="o">/</span><span class="n">total</span>
        <span class="k">return</span> <span class="n">histogram</span></div>

<div class="viewcode-block" id="MetadataSimilarity.histogram_distance"><a class="viewcode-back" href="../../core.util.html#core.util.MetadataSimilarity.histogram_distance">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">histogram_distance</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">strings_1</span><span class="p">,</span> <span class="n">strings_2</span><span class="p">,</span> <span class="n">stopwords</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculate the histogram distance between two sets of strings.</span>

<span class="sd">        The histogram distance is the sum of the word distance for</span>
<span class="sd">        every word that occurs in either histogram.</span>

<span class="sd">        If a word appears in one histogram but not the other, its word</span>
<span class="sd">        distance is its frequency of appearance. If a word appears in</span>
<span class="sd">        both histograms, its word distance is the absolute value of</span>
<span class="sd">        the difference between that word&#39;s frequency of appearance in</span>
<span class="sd">        histogram A, and its frequency of appearance in histogram B.</span>

<span class="sd">        If the strings use the same words at exactly the same</span>
<span class="sd">        frequency, the difference will be 0. If the strings use</span>
<span class="sd">        completely different words, the difference will be 1.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">stopwords</span><span class="p">:</span>
            <span class="n">stopwords</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s2">&quot;the&quot;</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;an&quot;</span><span class="p">])</span>

        <span class="n">histogram_1</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">strings_1</span><span class="p">,</span> <span class="n">stopwords</span><span class="o">=</span><span class="n">stopwords</span><span class="p">)</span>
        <span class="n">histogram_2</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">strings_2</span><span class="p">,</span> <span class="n">stopwords</span><span class="o">=</span><span class="n">stopwords</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">counter_distance</span><span class="p">(</span><span class="n">histogram_1</span><span class="p">,</span> <span class="n">histogram_2</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetadataSimilarity.counter_distance"><a class="viewcode-back" href="../../core.util.html#core.util.MetadataSimilarity.counter_distance">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">counter_distance</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">counter1</span><span class="p">,</span> <span class="n">counter2</span><span class="p">):</span>
        <span class="n">differences</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># For every item that appears in histogram 1, compare its</span>
        <span class="c1"># frequency against the frequency of that item in histogram 2.</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">counter1</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="n">difference</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">v</span> <span class="o">-</span> <span class="n">counter2</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            <span class="n">differences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">difference</span><span class="p">)</span>

        <span class="c1"># Add the frequency of every item that appears in histogram 2</span>
        <span class="c1"># titles but not in histogram 1.</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">counter2</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">counter1</span><span class="p">:</span>
                <span class="n">differences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>

        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">differences</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span></div>


<div class="viewcode-block" id="MetadataSimilarity.most_common"><a class="viewcode-back" href="../../core.util.html#core.util.MetadataSimilarity.most_common">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">most_common</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">maximum_size</span><span class="p">,</span> <span class="o">*</span><span class="n">items</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the most common item that&#39;s not longer than the max.&quot;&quot;&quot;</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">maximum_size</span><span class="p">:</span>
                <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">common</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">common</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">common</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span></div>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_wordbags_for_author</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">author</span><span class="p">):</span>
        <span class="n">bags</span> <span class="o">=</span> <span class="p">[</span><span class="bp">cls</span><span class="o">.</span><span class="n">_wordbag</span><span class="p">(</span><span class="n">author</span><span class="o">.</span><span class="n">sort_name</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">alias</span> <span class="ow">in</span> <span class="n">author</span><span class="o">.</span><span class="n">aliases</span><span class="p">:</span>
            <span class="n">bags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_wordbag</span><span class="p">(</span><span class="n">alias</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">bags</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_matching_author_in</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">to_match</span><span class="p">,</span> <span class="n">authors</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">author</span> <span class="ow">in</span> <span class="n">authors</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">author</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">to_match</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">name</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_word_match_proportion</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">stopwords</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;What proportion of words do s1 and s2 share, considered as wordbags?&quot;&quot;&quot;</span>
        <span class="n">b1</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_wordbag</span><span class="p">(</span><span class="n">s1</span><span class="p">)</span> <span class="o">-</span> <span class="n">stopwords</span>
        <span class="n">b2</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_wordbag</span><span class="p">(</span><span class="n">s2</span><span class="p">)</span> <span class="o">-</span> <span class="n">stopwords</span>
        <span class="k">return</span> <span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_proportion</span><span class="p">(</span><span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_proportion</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">s1</span> <span class="o">==</span> <span class="n">s2</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">1</span>
        <span class="n">total</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s1</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">s2</span><span class="p">))</span>
        <span class="n">shared</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s1</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">s2</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">total</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="n">shared</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">total</span><span class="p">)</span>

<div class="viewcode-block" id="MetadataSimilarity.title_similarity"><a class="viewcode-back" href="../../core.util.html#core.util.MetadataSimilarity.title_similarity">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">title_similarity</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">title1</span><span class="p">,</span> <span class="n">title2</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">title1</span> <span class="o">==</span> <span class="n">title2</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">title1</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">title2</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="n">proportion</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_word_match_proportion</span><span class="p">(</span>
            <span class="n">title1</span><span class="p">,</span> <span class="n">title2</span><span class="p">,</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;the&#39;</span><span class="p">,</span> <span class="s1">&#39;an&#39;</span><span class="p">]))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">b1</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">b2</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">):</span>
            <span class="c1"># Penalize titles where one title is not a subset of the</span>
            <span class="c1"># other. &quot;Tom Sawyer Abroad&quot; will not face an extra</span>
            <span class="c1"># penalty vis-a-vis &quot;Tom Sawyer&quot;, but it will face an</span>
            <span class="c1"># extra penalty vis-a-vis &quot;Tom Sawyer, Detective&quot;.</span>
            <span class="n">proportion</span> <span class="o">*=</span> <span class="mf">0.4</span>
        <span class="k">return</span> <span class="n">proportion</span></div>

<div class="viewcode-block" id="MetadataSimilarity.author_similarity"><a class="viewcode-back" href="../../core.util.html#core.util.MetadataSimilarity.author_similarity">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">author_similarity</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">authors1</span><span class="p">,</span> <span class="n">authors2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;What percentage of the total number of authors in the two sets</span>
<span class="sd">        are present in both sets?</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_proportion</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">authors1</span><span class="p">),</span> <span class="nb">set</span><span class="p">(</span><span class="n">authors2</span><span class="p">))</span></div>

<div class="viewcode-block" id="MetadataSimilarity.author_name_similarity"><a class="viewcode-back" href="../../core.util.html#core.util.MetadataSimilarity.author_name_similarity">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">author_name_similarity</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">authors1</span><span class="p">,</span> <span class="n">authors2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;What percentage of the total number of authors in the two sets</span>
<span class="sd">        are present in both sets?</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_proportion</span><span class="p">(</span>
            <span class="nb">set</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">sort_name</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">authors1</span><span class="p">]),</span> <span class="nb">set</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">sort_name</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">authors2</span><span class="p">]))</span></div></div>

<div class="viewcode-block" id="TitleProcessor"><a class="viewcode-back" href="../../core.util.html#core.util.TitleProcessor">[docs]</a><span class="k">class</span> <span class="nc">TitleProcessor</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="n">title_stopwords</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;The &#39;</span><span class="p">,</span> <span class="s1">&#39;A &#39;</span><span class="p">,</span> <span class="s1">&#39;An &#39;</span><span class="p">]</span>

<div class="viewcode-block" id="TitleProcessor.sort_title_for"><a class="viewcode-back" href="../../core.util.html#core.util.TitleProcessor.sort_title_for">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">sort_title_for</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">title</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">title</span>
        <span class="k">for</span> <span class="n">stopword</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">title_stopwords</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">title</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">stopword</span><span class="p">):</span>
                <span class="n">title</span> <span class="o">=</span> <span class="n">title</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">stopword</span><span class="p">):]</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="n">stopword</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">break</span>
        <span class="k">return</span> <span class="n">title</span></div>

<div class="viewcode-block" id="TitleProcessor.extract_subtitle"><a class="viewcode-back" href="../../core.util.html#core.util.TitleProcessor.extract_subtitle">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">extract_subtitle</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">main_title</span><span class="p">,</span> <span class="n">subtitled_title</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Extracts a subtitle given a shorter and longer title version</span>

<span class="sd">        :return: subtitle or None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">subtitled_title</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">subtitle</span> <span class="o">=</span> <span class="n">subtitled_title</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">main_title</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">subtitle</span> <span class="ow">and</span>
                <span class="p">(</span><span class="n">subtitle</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">string</span><span class="o">.</span><span class="n">whitespace</span><span class="o">+</span><span class="s1">&#39;:.&#39;</span><span class="p">)):</span>
            <span class="c1"># Trim any leading whitespace or colons</span>
            <span class="n">subtitle</span> <span class="o">=</span> <span class="n">subtitle</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">subtitle</span><span class="p">:</span>
            <span class="c1"># The main title and the full title were the same.</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">subtitle</span></div></div>


<div class="viewcode-block" id="Bigrams"><a class="viewcode-back" href="../../core.util.html#core.util.Bigrams">[docs]</a><span class="k">class</span> <span class="nc">Bigrams</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="n">all_letters</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;^[a-z]+$&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bigrams</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bigrams</span> <span class="o">=</span> <span class="n">bigrams</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proportional</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
        <span class="n">total</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">bigrams</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
        <span class="k">for</span> <span class="n">bigram</span><span class="p">,</span> <span class="n">quantity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bigrams</span><span class="o">.</span><span class="n">most_common</span><span class="p">():</span>
            <span class="n">proportion</span> <span class="o">=</span> <span class="n">quantity</span><span class="o">/</span><span class="n">total</span>
            <span class="k">if</span> <span class="n">proportion</span> <span class="o">&lt;</span> <span class="mf">0.001</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">proportional</span><span class="p">[</span><span class="n">bigram</span><span class="p">]</span> <span class="o">=</span> <span class="n">proportion</span>

<div class="viewcode-block" id="Bigrams.difference_from"><a class="viewcode-back" href="../../core.util.html#core.util.Bigrams.difference_from">[docs]</a>    <span class="k">def</span> <span class="nf">difference_from</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_bigrams</span><span class="p">):</span>
        <span class="n">total_difference</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">bigram</span><span class="p">,</span> <span class="n">proportion</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">proportional</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="n">other_proportion</span> <span class="o">=</span> <span class="n">other_bigrams</span><span class="o">.</span><span class="n">proportional</span><span class="p">[</span><span class="n">bigram</span><span class="p">]</span>
            <span class="n">difference</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">other_proportion</span> <span class="o">-</span> <span class="n">proportion</span><span class="p">)</span>
            <span class="n">total_difference</span> <span class="o">+=</span> <span class="n">difference</span>
            <span class="c1"># print(&quot;%s %.4f-%.4f = %.4f =&gt; %.4f&quot; % (bigram, other_proportion, proportion, difference, total_difference))</span>
        <span class="k">for</span> <span class="n">bigram</span><span class="p">,</span> <span class="n">proportion</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">other_bigrams</span><span class="o">.</span><span class="n">proportional</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">bigram</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">proportional</span><span class="p">:</span>
                <span class="n">total_difference</span> <span class="o">+=</span> <span class="n">proportion</span>
                <span class="c1"># print(&quot;%s MISSING %.4f =&gt; %.4f&quot; % (bigram, proportion, total_difference))</span>
        <span class="k">return</span> <span class="n">total_difference</span></div>

<div class="viewcode-block" id="Bigrams.from_text_files"><a class="viewcode-back" href="../../core.util.html#core.util.Bigrams.from_text_files">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_text_files</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">paths</span><span class="p">):</span>
        <span class="n">bigrams</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">process_data</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">bigrams</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Bigrams</span><span class="p">(</span><span class="n">bigrams</span><span class="p">)</span></div>

<div class="viewcode-block" id="Bigrams.from_string"><a class="viewcode-back" href="../../core.util.html#core.util.Bigrams.from_string">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_string</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">string</span><span class="p">):</span>
        <span class="n">bigrams</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">process_data</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">bigrams</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Bigrams</span><span class="p">(</span><span class="n">bigrams</span><span class="p">)</span></div>

<div class="viewcode-block" id="Bigrams.process_data"><a class="viewcode-back" href="../../core.util.html#core.util.Bigrams.process_data">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">process_data</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">bigrams</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">bigram</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">bigram</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="bp">cls</span><span class="o">.</span><span class="n">all_letters</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">bigram</span><span class="p">):</span>
                <span class="n">bigrams</span><span class="p">[</span><span class="n">bigram</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">+=</span> <span class="mi">1</span></div></div>

<span class="n">english_bigram_frequencies</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;ab&quot;</span><span class="p">:</span> <span class="mf">0.0021712725750437792</span><span class="p">,</span>
    <span class="s2">&quot;ac&quot;</span><span class="p">:</span> <span class="mf">0.005213707466347486</span><span class="p">,</span>
    <span class="s2">&quot;ad&quot;</span><span class="p">:</span> <span class="mf">0.004761174757224308</span><span class="p">,</span>
    <span class="s2">&quot;ag&quot;</span><span class="p">:</span> <span class="mf">0.002362898803662714</span><span class="p">,</span>
    <span class="s2">&quot;ai&quot;</span><span class="p">:</span> <span class="mf">0.004243783939953184</span><span class="p">,</span>
    <span class="s2">&quot;ak&quot;</span><span class="p">:</span> <span class="mf">0.0016317710390858545</span><span class="p">,</span>
    <span class="s2">&quot;al&quot;</span><span class="p">:</span> <span class="mf">0.009420640208489336</span><span class="p">,</span>
    <span class="s2">&quot;am&quot;</span><span class="p">:</span> <span class="mf">0.0022184421082422864</span><span class="p">,</span>
    <span class="s2">&quot;an&quot;</span><span class="p">:</span> <span class="mf">0.019261384072027876</span><span class="p">,</span>
    <span class="s2">&quot;ap&quot;</span><span class="p">:</span> <span class="mf">0.001748220824169669</span><span class="p">,</span>
    <span class="s2">&quot;ar&quot;</span><span class="p">:</span> <span class="mf">0.010173878691752996</span><span class="p">,</span>
    <span class="s2">&quot;as&quot;</span><span class="p">:</span> <span class="mf">0.009223117788220589</span><span class="p">,</span>
    <span class="s2">&quot;at&quot;</span><span class="p">:</span> <span class="mf">0.01276525492184598</span><span class="p">,</span>
    <span class="s2">&quot;au&quot;</span><span class="p">:</span> <span class="mf">0.0010539442574041427</span><span class="p">,</span>
    <span class="s2">&quot;av&quot;</span><span class="p">:</span> <span class="mf">0.0018941515675025501</span><span class="p">,</span>
    <span class="s2">&quot;ay&quot;</span><span class="p">:</span> <span class="mf">0.0026193831404295966</span><span class="p">,</span>
    <span class="s2">&quot;ba&quot;</span><span class="p">:</span> <span class="mf">0.001463729577066173</span><span class="p">,</span>
    <span class="s2">&quot;be&quot;</span><span class="p">:</span> <span class="mf">0.005828385445840531</span><span class="p">,</span>
    <span class="s2">&quot;bl&quot;</span><span class="p">:</span> <span class="mf">0.002477874540834075</span><span class="p">,</span>
    <span class="s2">&quot;bo&quot;</span><span class="p">:</span> <span class="mf">0.0026577083861533835</span><span class="p">,</span>
    <span class="s2">&quot;br&quot;</span><span class="p">:</span> <span class="mf">0.0010568923532290493</span><span class="p">,</span>
    <span class="s2">&quot;bu&quot;</span><span class="p">:</span> <span class="mf">0.002104940418983379</span><span class="p">,</span>
    <span class="s2">&quot;by&quot;</span><span class="p">:</span> <span class="mf">0.0013163247858208383</span><span class="p">,</span>
    <span class="s2">&quot;ca&quot;</span><span class="p">:</span> <span class="mf">0.004967541464967778</span><span class="p">,</span>
    <span class="s2">&quot;ce&quot;</span><span class="p">:</span> <span class="mf">0.006574253689541925</span><span class="p">,</span>
    <span class="s2">&quot;ch&quot;</span><span class="p">:</span> <span class="mf">0.004742012134362416</span><span class="p">,</span>
    <span class="s2">&quot;ci&quot;</span><span class="p">:</span> <span class="mf">0.002072511364909405</span><span class="p">,</span>
    <span class="s2">&quot;ck&quot;</span><span class="p">:</span> <span class="mf">0.0032694382698215223</span><span class="p">,</span>
    <span class="s2">&quot;cl&quot;</span><span class="p">:</span> <span class="mf">0.0010966916468652897</span><span class="p">,</span>
    <span class="s2">&quot;co&quot;</span><span class="p">:</span> <span class="mf">0.007743173684117428</span><span class="p">,</span>
    <span class="s2">&quot;cr&quot;</span><span class="p">:</span> <span class="mf">0.0021771687666935925</span><span class="p">,</span>
    <span class="s2">&quot;ct&quot;</span><span class="p">:</span> <span class="mf">0.0035804623793491783</span><span class="p">,</span>
    <span class="s2">&quot;cu&quot;</span><span class="p">:</span> <span class="mf">0.0016922070034964417</span><span class="p">,</span>
    <span class="s2">&quot;da&quot;</span><span class="p">:</span> <span class="mf">0.0015005807748775066</span><span class="p">,</span>
    <span class="s2">&quot;de&quot;</span><span class="p">:</span> <span class="mf">0.006702495857925366</span><span class="p">,</span>
    <span class="s2">&quot;di&quot;</span><span class="p">:</span> <span class="mf">0.003999091986485929</span><span class="p">,</span>
    <span class="s2">&quot;do&quot;</span><span class="p">:</span> <span class="mf">0.0031824694429867747</span><span class="p">,</span>
    <span class="s2">&quot;ds&quot;</span><span class="p">:</span> <span class="mf">0.0014740479124533464</span><span class="p">,</span>
    <span class="s2">&quot;ea&quot;</span><span class="p">:</span> <span class="mf">0.007121125465062116</span><span class="p">,</span>
    <span class="s2">&quot;ec&quot;</span><span class="p">:</span> <span class="mf">0.005023555285641005</span><span class="p">,</span>
    <span class="s2">&quot;ed&quot;</span><span class="p">:</span> <span class="mf">0.012741670155246725</span><span class="p">,</span>
    <span class="s2">&quot;ee&quot;</span><span class="p">:</span> <span class="mf">0.0045415416182687605</span><span class="p">,</span>
    <span class="s2">&quot;ef&quot;</span><span class="p">:</span> <span class="mf">0.0013325393128578251</span><span class="p">,</span>
    <span class="s2">&quot;eg&quot;</span><span class="p">:</span> <span class="mf">0.001064262592791316</span><span class="p">,</span>
    <span class="s2">&quot;ei&quot;</span><span class="p">:</span> <span class="mf">0.0018351896510044163</span><span class="p">,</span>
    <span class="s2">&quot;el&quot;</span><span class="p">:</span> <span class="mf">0.00604359644105872</span><span class="p">,</span>
    <span class="s2">&quot;em&quot;</span><span class="p">:</span> <span class="mf">0.003947500309550061</span><span class="p">,</span>
    <span class="s2">&quot;en&quot;</span><span class="p">:</span> <span class="mf">0.01328117169120465</span><span class="p">,</span>
    <span class="s2">&quot;ep&quot;</span><span class="p">:</span> <span class="mf">0.0017762277345062824</span><span class="p">,</span>
    <span class="s2">&quot;er&quot;</span><span class="p">:</span> <span class="mf">0.02339461441854706</span><span class="p">,</span>
    <span class="s2">&quot;es&quot;</span><span class="p">:</span> <span class="mf">0.010507013519967454</span><span class="p">,</span>
    <span class="s2">&quot;et&quot;</span><span class="p">:</span> <span class="mf">0.004740538086449962</span><span class="p">,</span>
    <span class="s2">&quot;ev&quot;</span><span class="p">:</span> <span class="mf">0.0024631340617095416</span><span class="p">,</span>
    <span class="s2">&quot;ew&quot;</span><span class="p">:</span> <span class="mf">0.001260310965147611</span><span class="p">,</span>
    <span class="s2">&quot;ex&quot;</span><span class="p">:</span> <span class="mf">0.0015035288707024132</span><span class="p">,</span>
    <span class="s2">&quot;ey&quot;</span><span class="p">:</span> <span class="mf">0.002464608109621995</span><span class="p">,</span>
    <span class="s2">&quot;fa&quot;</span><span class="p">:</span> <span class="mf">0.0013045324025212116</span><span class="p">,</span>
    <span class="s2">&quot;fe&quot;</span><span class="p">:</span> <span class="mf">0.002000283017199191</span><span class="p">,</span>
    <span class="s2">&quot;ff&quot;</span><span class="p">:</span> <span class="mf">0.0015919717454496141</span><span class="p">,</span>
    <span class="s2">&quot;fi&quot;</span><span class="p">:</span> <span class="mf">0.0024395492951102883</span><span class="p">,</span>
    <span class="s2">&quot;fo&quot;</span><span class="p">:</span> <span class="mf">0.004199562502579583</span><span class="p">,</span>
    <span class="s2">&quot;fr&quot;</span><span class="p">:</span> <span class="mf">0.0018233972677047896</span><span class="p">,</span>
    <span class="s2">&quot;ft&quot;</span><span class="p">:</span> <span class="mf">0.0012278819110736374</span><span class="p">,</span>
    <span class="s2">&quot;fu&quot;</span><span class="p">:</span> <span class="mf">0.0010524702094916894</span><span class="p">,</span>
    <span class="s2">&quot;ga&quot;</span><span class="p">:</span> <span class="mf">0.001748220824169669</span><span class="p">,</span>
    <span class="s2">&quot;ge&quot;</span><span class="p">:</span> <span class="mf">0.003719022883119793</span><span class="p">,</span>
    <span class="s2">&quot;gh&quot;</span><span class="p">:</span> <span class="mf">0.0031839434908992282</span><span class="p">,</span>
    <span class="s2">&quot;gi&quot;</span><span class="p">:</span> <span class="mf">0.0014755219603657997</span><span class="p">,</span>
    <span class="s2">&quot;go&quot;</span><span class="p">:</span> <span class="mf">0.0016332450869983078</span><span class="p">,</span>
    <span class="s2">&quot;gr&quot;</span><span class="p">:</span> <span class="mf">0.002012075400498818</span><span class="p">,</span>
    <span class="s2">&quot;ha&quot;</span><span class="p">:</span> <span class="mf">0.010978708851952524</span><span class="p">,</span>
    <span class="s2">&quot;he&quot;</span><span class="p">:</span> <span class="mf">0.03081791970566211</span><span class="p">,</span>
    <span class="s2">&quot;hi&quot;</span><span class="p">:</span> <span class="mf">0.007993761829234497</span><span class="p">,</span>
    <span class="s2">&quot;ho&quot;</span><span class="p">:</span> <span class="mf">0.00562496683392197</span><span class="p">,</span>
    <span class="s2">&quot;hr&quot;</span><span class="p">:</span> <span class="mf">0.0012308300068985443</span><span class="p">,</span>
    <span class="s2">&quot;ht&quot;</span><span class="p">:</span> <span class="mf">0.002037134215010525</span><span class="p">,</span>
    <span class="s2">&quot;ia&quot;</span><span class="p">:</span> <span class="mf">0.0017334803450451354</span><span class="p">,</span>
    <span class="s2">&quot;ib&quot;</span><span class="p">:</span> <span class="mf">0.001068684736528676</span><span class="p">,</span>
    <span class="s2">&quot;ic&quot;</span><span class="p">:</span> <span class="mf">0.007367291466441825</span><span class="p">,</span>
    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mf">0.004277687041939611</span><span class="p">,</span>
    <span class="s2">&quot;ie&quot;</span><span class="p">:</span> <span class="mf">0.0031692030117746947</span><span class="p">,</span>
    <span class="s2">&quot;if&quot;</span><span class="p">:</span> <span class="mf">0.001578705314237534</span><span class="p">,</span>
    <span class="s2">&quot;ig&quot;</span><span class="p">:</span> <span class="mf">0.0029687324956810396</span><span class="p">,</span>
    <span class="s2">&quot;il&quot;</span><span class="p">:</span> <span class="mf">0.004321908479313212</span><span class="p">,</span>
    <span class="s2">&quot;im&quot;</span><span class="p">:</span> <span class="mf">0.0030615975141656004</span><span class="p">,</span>
    <span class="s2">&quot;in&quot;</span><span class="p">:</span> <span class="mf">0.02371595686346189</span><span class="p">,</span>
    <span class="s2">&quot;io&quot;</span><span class="p">:</span> <span class="mf">0.005216655562172393</span><span class="p">,</span>
    <span class="s2">&quot;ir&quot;</span><span class="p">:</span> <span class="mf">0.003085182280764854</span><span class="p">,</span>
    <span class="s2">&quot;is&quot;</span><span class="p">:</span> <span class="mf">0.008928308205729919</span><span class="p">,</span>
    <span class="s2">&quot;it&quot;</span><span class="p">:</span> <span class="mf">0.011687725897842583</span><span class="p">,</span>
    <span class="s2">&quot;iv&quot;</span><span class="p">:</span> <span class="mf">0.0021801168625184995</span><span class="p">,</span>
    <span class="s2">&quot;ke&quot;</span><span class="p">:</span> <span class="mf">0.004137652490256543</span><span class="p">,</span>
    <span class="s2">&quot;ki&quot;</span><span class="p">:</span> <span class="mf">0.0015521724518133737</span><span class="p">,</span>
    <span class="s2">&quot;ks&quot;</span><span class="p">:</span> <span class="mf">0.0010657366407037694</span><span class="p">,</span>
    <span class="s2">&quot;la&quot;</span><span class="p">:</span> <span class="mf">0.003962240788674595</span><span class="p">,</span>
    <span class="s2">&quot;ld&quot;</span><span class="p">:</span> <span class="mf">0.0029628363040312264</span><span class="p">,</span>
    <span class="s2">&quot;le&quot;</span><span class="p">:</span> <span class="mf">0.009557726664347498</span><span class="p">,</span>
    <span class="s2">&quot;li&quot;</span><span class="p">:</span> <span class="mf">0.006910336613581288</span><span class="p">,</span>
    <span class="s2">&quot;ll&quot;</span><span class="p">:</span> <span class="mf">0.007724011061255535</span><span class="p">,</span>
    <span class="s2">&quot;lo&quot;</span><span class="p">:</span> <span class="mf">0.0036350021521099523</span><span class="p">,</span>
    <span class="s2">&quot;ls&quot;</span><span class="p">:</span> <span class="mf">0.0010274113949799825</span><span class="p">,</span>
    <span class="s2">&quot;ly&quot;</span><span class="p">:</span> <span class="mf">0.0051871746039233255</span><span class="p">,</span>
    <span class="s2">&quot;ma&quot;</span><span class="p">:</span> <span class="mf">0.004444254456046839</span><span class="p">,</span>
    <span class="s2">&quot;me&quot;</span><span class="p">:</span> <span class="mf">0.00833868904074858</span><span class="p">,</span>
    <span class="s2">&quot;mi&quot;</span><span class="p">:</span> <span class="mf">0.0025766357509684496</span><span class="p">,</span>
    <span class="s2">&quot;mo&quot;</span><span class="p">:</span> <span class="mf">0.0027977429378364515</span><span class="p">,</span>
    <span class="s2">&quot;mp&quot;</span><span class="p">:</span> <span class="mf">0.0029304072499572527</span><span class="p">,</span>
    <span class="s2">&quot;mu&quot;</span><span class="p">:</span> <span class="mf">0.0011689199945755036</span><span class="p">,</span>
    <span class="s2">&quot;my&quot;</span><span class="p">:</span> <span class="mf">0.0012558888214102512</span><span class="p">,</span>
    <span class="s2">&quot;na&quot;</span><span class="p">:</span> <span class="mf">0.0025810578947058093</span><span class="p">,</span>
    <span class="s2">&quot;nc&quot;</span><span class="p">:</span> <span class="mf">0.002830171991910425</span><span class="p">,</span>
    <span class="s2">&quot;nd&quot;</span><span class="p">:</span> <span class="mf">0.014385233577632207</span><span class="p">,</span>
    <span class="s2">&quot;ne&quot;</span><span class="p">:</span> <span class="mf">0.007968703014722791</span><span class="p">,</span>
    <span class="s2">&quot;ng&quot;</span><span class="p">:</span> <span class="mf">0.01172162899982901</span><span class="p">,</span>
    <span class="s2">&quot;ni&quot;</span><span class="p">:</span> <span class="mf">0.003599625002211072</span><span class="p">,</span>
    <span class="s2">&quot;no&quot;</span><span class="p">:</span> <span class="mf">0.004734641894800148</span><span class="p">,</span>
    <span class="s2">&quot;ns&quot;</span><span class="p">:</span> <span class="mf">0.003651216679146939</span><span class="p">,</span>
    <span class="s2">&quot;nt&quot;</span><span class="p">:</span> <span class="mf">0.008982847978490693</span><span class="p">,</span>
    <span class="s2">&quot;ny&quot;</span><span class="p">:</span> <span class="mf">0.0015698610267628138</span><span class="p">,</span>
    <span class="s2">&quot;oc&quot;</span><span class="p">:</span> <span class="mf">0.0017187398659206019</span><span class="p">,</span>
    <span class="s2">&quot;od&quot;</span><span class="p">:</span> <span class="mf">0.0017718055907689223</span><span class="p">,</span>
    <span class="s2">&quot;of&quot;</span><span class="p">:</span> <span class="mf">0.009453069262563311</span><span class="p">,</span>
    <span class="s2">&quot;oi&quot;</span><span class="p">:</span> <span class="mf">0.0010229892512426224</span><span class="p">,</span>
    <span class="s2">&quot;ok&quot;</span><span class="p">:</span> <span class="mf">0.0014946845832276932</span><span class="p">,</span>
    <span class="s2">&quot;ol&quot;</span><span class="p">:</span> <span class="mf">0.0031087670473641076</span><span class="p">,</span>
    <span class="s2">&quot;om&quot;</span><span class="p">:</span> <span class="mf">0.006596364408228725</span><span class="p">,</span>
    <span class="s2">&quot;on&quot;</span><span class="p">:</span> <span class="mf">0.015450970218335977</span><span class="p">,</span>
    <span class="s2">&quot;oo&quot;</span><span class="p">:</span> <span class="mf">0.0033667254320434432</span><span class="p">,</span>
    <span class="s2">&quot;op&quot;</span><span class="p">:</span> <span class="mf">0.0026650786257156503</span><span class="p">,</span>
    <span class="s2">&quot;or&quot;</span><span class="p">:</span> <span class="mf">0.012544147734977978</span><span class="p">,</span>
    <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="mf">0.0024248088159857547</span><span class="p">,</span>
    <span class="s2">&quot;ot&quot;</span><span class="p">:</span> <span class="mf">0.004404455162410599</span><span class="p">,</span>
    <span class="s2">&quot;ou&quot;</span><span class="p">:</span> <span class="mf">0.012628168465987818</span><span class="p">,</span>
    <span class="s2">&quot;ov&quot;</span><span class="p">:</span> <span class="mf">0.0014814181520156132</span><span class="p">,</span>
    <span class="s2">&quot;ow&quot;</span><span class="p">:</span> <span class="mf">0.004357285629212092</span><span class="p">,</span>
    <span class="s2">&quot;pa&quot;</span><span class="p">:</span> <span class="mf">0.0024248088159857547</span><span class="p">,</span>
    <span class="s2">&quot;pe&quot;</span><span class="p">:</span> <span class="mf">0.004336648958437745</span><span class="p">,</span>
    <span class="s2">&quot;ph&quot;</span><span class="p">:</span> <span class="mf">0.001596393889186974</span><span class="p">,</span>
    <span class="s2">&quot;pi&quot;</span><span class="p">:</span> <span class="mf">0.0014047676605680392</span><span class="p">,</span>
    <span class="s2">&quot;pl&quot;</span><span class="p">:</span> <span class="mf">0.0026621305298907437</span><span class="p">,</span>
    <span class="s2">&quot;po&quot;</span><span class="p">:</span> <span class="mf">0.0027137222068266105</span><span class="p">,</span>
    <span class="s2">&quot;pp&quot;</span><span class="p">:</span> <span class="mf">0.0012897919233966781</span><span class="p">,</span>
    <span class="s2">&quot;pr&quot;</span><span class="p">:</span> <span class="mf">0.003148566341000348</span><span class="p">,</span>
    <span class="s2">&quot;pu&quot;</span><span class="p">:</span> <span class="mf">0.002514725738645409</span><span class="p">,</span>
    <span class="s2">&quot;qu&quot;</span><span class="p">:</span> <span class="mf">0.0011851345216124904</span><span class="p">,</span>
    <span class="s2">&quot;ra&quot;</span><span class="p">:</span> <span class="mf">0.00642242675455923</span><span class="p">,</span>
    <span class="s2">&quot;rc&quot;</span><span class="p">:</span> <span class="mf">0.001068684736528676</span><span class="p">,</span>
    <span class="s2">&quot;rd&quot;</span><span class="p">:</span> <span class="mf">0.0022656116414407935</span><span class="p">,</span>
    <span class="s2">&quot;re&quot;</span><span class="p">:</span> <span class="mf">0.016922070034964418</span><span class="p">,</span>
    <span class="s2">&quot;rg&quot;</span><span class="p">:</span> <span class="mf">0.0016332450869983078</span><span class="p">,</span>
    <span class="s2">&quot;ri&quot;</span><span class="p">:</span> <span class="mf">0.00681010135553446</span><span class="p">,</span>
    <span class="s2">&quot;rk&quot;</span><span class="p">:</span> <span class="mf">0.0017261101054828686</span><span class="p">,</span>
    <span class="s2">&quot;rl&quot;</span><span class="p">:</span> <span class="mf">0.001046574017841876</span><span class="p">,</span>
    <span class="s2">&quot;rm&quot;</span><span class="p">:</span> <span class="mf">0.0016317710390858545</span><span class="p">,</span>
    <span class="s2">&quot;rn&quot;</span><span class="p">:</span> <span class="mf">0.001328117169120465</span><span class="p">,</span>
    <span class="s2">&quot;ro&quot;</span><span class="p">:</span> <span class="mf">0.007760862259066869</span><span class="p">,</span>
    <span class="s2">&quot;rr&quot;</span><span class="p">:</span> <span class="mf">0.0010878473593905697</span><span class="p">,</span>
    <span class="s2">&quot;rs&quot;</span><span class="p">:</span> <span class="mf">0.004743486182274869</span><span class="p">,</span>
    <span class="s2">&quot;rt&quot;</span><span class="p">:</span> <span class="mf">0.0029893691664553863</span><span class="p">,</span>
    <span class="s2">&quot;ru&quot;</span><span class="p">:</span> <span class="mf">0.0013177988337332916</span><span class="p">,</span>
    <span class="s2">&quot;ry&quot;</span><span class="p">:</span> <span class="mf">0.002701929823526984</span><span class="p">,</span>
    <span class="s2">&quot;sa&quot;</span><span class="p">:</span> <span class="mf">0.0028758674771964788</span><span class="p">,</span>
    <span class="s2">&quot;sc&quot;</span><span class="p">:</span> <span class="mf">0.0012691552526223311</span><span class="p">,</span>
    <span class="s2">&quot;se&quot;</span><span class="p">:</span> <span class="mf">0.008092523039368872</span><span class="p">,</span>
    <span class="s2">&quot;sh&quot;</span><span class="p">:</span> <span class="mf">0.0038148359974292606</span><span class="p">,</span>
    <span class="s2">&quot;si&quot;</span><span class="p">:</span> <span class="mf">0.004310116096013585</span><span class="p">,</span>
    <span class="s2">&quot;so&quot;</span><span class="p">:</span> <span class="mf">0.0036910159727831793</span><span class="p">,</span>
    <span class="s2">&quot;sp&quot;</span><span class="p">:</span> <span class="mf">0.0017718055907689223</span><span class="p">,</span>
    <span class="s2">&quot;ss&quot;</span><span class="p">:</span> <span class="mf">0.0034404278276661104</span><span class="p">,</span>
    <span class="s2">&quot;st&quot;</span><span class="p">:</span> <span class="mf">0.01015324202097865</span><span class="p">,</span>
    <span class="s2">&quot;su&quot;</span><span class="p">:</span> <span class="mf">0.0018631965613410298</span><span class="p">,</span>
    <span class="s2">&quot;ta&quot;</span><span class="p">:</span> <span class="mf">0.004728745703150335</span><span class="p">,</span>
    <span class="s2">&quot;te&quot;</span><span class="p">:</span> <span class="mf">0.013699801298341401</span><span class="p">,</span>
    <span class="s2">&quot;th&quot;</span><span class="p">:</span> <span class="mf">0.031493033649565745</span><span class="p">,</span>
    <span class="s2">&quot;ti&quot;</span><span class="p">:</span> <span class="mf">0.009472231885425203</span><span class="p">,</span>
    <span class="s2">&quot;tl&quot;</span><span class="p">:</span> <span class="mf">0.0016745184285470015</span><span class="p">,</span>
    <span class="s2">&quot;to&quot;</span><span class="p">:</span> <span class="mf">0.010639677832088254</span><span class="p">,</span>
    <span class="s2">&quot;tr&quot;</span><span class="p">:</span> <span class="mf">0.0039519224532874216</span><span class="p">,</span>
    <span class="s2">&quot;ts&quot;</span><span class="p">:</span> <span class="mf">0.0027933207940990913</span><span class="p">,</span>
    <span class="s2">&quot;tt&quot;</span><span class="p">:</span> <span class="mf">0.0022449749706664464</span><span class="p">,</span>
    <span class="s2">&quot;tu&quot;</span><span class="p">:</span> <span class="mf">0.0017644353512066555</span><span class="p">,</span>
    <span class="s2">&quot;ty&quot;</span><span class="p">:</span> <span class="mf">0.0020164975442361777</span><span class="p">,</span>
    <span class="s2">&quot;ub&quot;</span><span class="p">:</span> <span class="mf">0.0011114321259898233</span><span class="p">,</span>
    <span class="s2">&quot;uc&quot;</span><span class="p">:</span> <span class="mf">0.0013590721752819853</span><span class="p">,</span>
    <span class="s2">&quot;ue&quot;</span><span class="p">:</span> <span class="mf">0.0012529407255853443</span><span class="p">,</span>
    <span class="s2">&quot;ug&quot;</span><span class="p">:</span> <span class="mf">0.0015904976975371608</span><span class="p">,</span>
    <span class="s2">&quot;ui&quot;</span><span class="p">:</span> <span class="mf">0.0010952175989528364</span><span class="p">,</span>
    <span class="s2">&quot;ul&quot;</span><span class="p">:</span> <span class="mf">0.0035052859358140577</span><span class="p">,</span>
    <span class="s2">&quot;um&quot;</span><span class="p">:</span> <span class="mf">0.0012323040548109976</span><span class="p">,</span>
    <span class="s2">&quot;un&quot;</span><span class="p">:</span> <span class="mf">0.004690420457426548</span><span class="p">,</span>
    <span class="s2">&quot;up&quot;</span><span class="p">:</span> <span class="mf">0.0018956256154150034</span><span class="p">,</span>
    <span class="s2">&quot;ur&quot;</span><span class="p">:</span> <span class="mf">0.0044309880248347595</span><span class="p">,</span>
    <span class="s2">&quot;us&quot;</span><span class="p">:</span> <span class="mf">0.004758226661399402</span><span class="p">,</span>
    <span class="s2">&quot;ut&quot;</span><span class="p">:</span> <span class="mf">0.007224308818933851</span><span class="p">,</span>
    <span class="s2">&quot;ve&quot;</span><span class="p">:</span> <span class="mf">0.008085152799806605</span><span class="p">,</span>
    <span class="s2">&quot;vi&quot;</span><span class="p">:</span> <span class="mf">0.0024498676304974616</span><span class="p">,</span>
    <span class="s2">&quot;wa&quot;</span><span class="p">:</span> <span class="mf">0.00562938897765933</span><span class="p">,</span>
    <span class="s2">&quot;we&quot;</span><span class="p">:</span> <span class="mf">0.0034581164026155505</span><span class="p">,</span>
    <span class="s2">&quot;wh&quot;</span><span class="p">:</span> <span class="mf">0.0031721511075996013</span><span class="p">,</span>
    <span class="s2">&quot;wi&quot;</span><span class="p">:</span> <span class="mf">0.0038531612431530475</span><span class="p">,</span>
    <span class="s2">&quot;wn&quot;</span><span class="p">:</span> <span class="mf">0.0013413836003325452</span><span class="p">,</span>
    <span class="s2">&quot;wo&quot;</span><span class="p">:</span> <span class="mf">0.0029937913101927465</span><span class="p">,</span>
    <span class="s2">&quot;ye&quot;</span><span class="p">:</span> <span class="mf">0.0010288854428924358</span><span class="p">,</span>
    <span class="s2">&quot;yo&quot;</span><span class="p">:</span> <span class="mf">0.002843438423122505</span><span class="p">,</span>
    <span class="s2">&quot;ys&quot;</span><span class="p">:</span> <span class="mf">0.0013649683669317988</span>
<span class="p">}</span>
<span class="n">english_bigrams</span> <span class="o">=</span> <span class="n">Bigrams</span><span class="p">(</span><span class="n">Counter</span><span class="p">())</span>
<span class="n">english_bigrams</span><span class="o">.</span><span class="n">proportional</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">english_bigram_frequencies</span><span class="p">)</span>


<div class="viewcode-block" id="MoneyUtility"><a class="viewcode-back" href="../../core.util.html#core.util.MoneyUtility">[docs]</a><span class="k">class</span> <span class="nc">MoneyUtility</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="n">DEFAULT_CURRENCY</span> <span class="o">=</span> <span class="s1">&#39;USD&#39;</span>

<div class="viewcode-block" id="MoneyUtility.parse"><a class="viewcode-back" href="../../core.util.html#core.util.MoneyUtility.parse">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Attempt to turn a string into a Money object.&quot;&quot;&quot;</span>
        <span class="n">currency</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">DEFAULT_CURRENCY</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">amount</span><span class="p">:</span>
            <span class="n">amount</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span>
        <span class="n">amount</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">amount</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;$&#39;</span><span class="p">:</span>
            <span class="n">currency</span> <span class="o">=</span> <span class="s1">&#39;USD&#39;</span>
            <span class="n">amount</span> <span class="o">=</span> <span class="n">amount</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">return</span> <span class="n">Money</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="n">currency</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="is_session"><a class="viewcode-back" href="../../core.util.html#core.util.is_session">[docs]</a><span class="k">def</span> <span class="nf">is_session</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return a boolean value indicating whether the value is a valid SQLAlchemy session.</span>

<span class="sd">    :param value: Value</span>
<span class="sd">    :type value: Any</span>

<span class="sd">    :return: Boolean value indicating whether the value is a valid SQLAlchemy session or not</span>
<span class="sd">    :rtype: bool</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="n">sqlalchemy</span><span class="o">.</span><span class="n">orm</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">Session</span><span class="p">,</span> <span class="n">flask_sqlalchemy_session</span><span class="o">.</span><span class="n">flask_scoped_session</span><span class="p">))</span></div>


<div class="viewcode-block" id="first_or_default"><a class="viewcode-back" href="../../core.util.html#core.util.first_or_default">[docs]</a><span class="k">def</span> <span class="nf">first_or_default</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return first element of the specified collection or the default value if the collection is empty.</span>

<span class="sd">    :param collection: Collection</span>
<span class="sd">    :type collection: Iterable</span>

<span class="sd">    :param default: Default value</span>
<span class="sd">    :type default: Any</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">element</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">collection</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">element</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">element</span> <span class="o">=</span> <span class="n">default</span>

    <span class="k">return</span> <span class="n">element</span></div>


<div class="viewcode-block" id="chunks"><a class="viewcode-back" href="../../core.util.html#core.util.chunks">[docs]</a><span class="k">def</span> <span class="nf">chunks</span><span class="p">(</span><span class="n">lst</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">,</span> <span class="n">start_index</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Yield successive n-sized chunks from lst.&quot;&quot;&quot;</span>
    <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_index</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">):</span>
        <span class="k">yield</span> <span class="n">lst</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="n">chunk_size</span><span class="p">]</span></div>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">Library Simplified Circulation Manager</a></h1>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">circulation</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, The New York Public Library, Astor, Lenox, and Tilden Foundations.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 5.0.0b1</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
    </div>

    

    
  </body>
</html>