
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>core.util.webpub_manifest_parser.core.parsers &#8212; Library Simplified Circulation Manager  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../_static/alabaster.css" />
    <script data-url_root="../../../../../" id="documentation_options" src="../../../../../_static/documentation_options.js"></script>
    <script src="../../../../../_static/jquery.js"></script>
    <script src="../../../../../_static/underscore.js"></script>
    <script src="../../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" />
   
  <link rel="stylesheet" href="../../../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for core.util.webpub_manifest_parser.core.parsers</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABCMeta</span><span class="p">,</span> <span class="n">abstractmethod</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">StringIO</span>
<span class="kn">from</span> <span class="nn">pydoc</span> <span class="kn">import</span> <span class="n">locate</span>

<span class="kn">import</span> <span class="nn">jsonschema</span>  <span class="c1"># noqa: I201</span>
<span class="kn">import</span> <span class="nn">requests</span>  <span class="c1"># noqa: I201</span>
<span class="kn">import</span> <span class="nn">six</span>  <span class="c1"># noqa: I201</span>
<span class="kn">import</span> <span class="nn">strict_rfc3339</span>  <span class="c1"># noqa: I201</span>
<span class="kn">from</span> <span class="nn">jsonschema</span> <span class="kn">import</span> <span class="n">FormatError</span>  <span class="c1"># noqa: I201, I100</span>
<span class="kn">from</span> <span class="nn">uritemplate</span> <span class="kn">import</span> <span class="n">URITemplate</span>  <span class="c1"># noqa: I201</span>

<span class="kn">import</span> <span class="nn">core.util.webpub_manifest_parser.core.errors</span>
<span class="kn">from</span> <span class="nn">core.util.webpub_manifest_parser.utils</span> <span class="kn">import</span> <span class="n">encode</span><span class="p">,</span> <span class="n">is_string</span>


<div class="viewcode-block" id="ValueParsingError"><a class="viewcode-back" href="../../../../../core.util.webpub_manifest_parser.core.html#core.util.webpub_manifest_parser.core.ast.ValueParsingError">[docs]</a><span class="k">class</span> <span class="nc">ValueParsingError</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">webpub_manifest_parser</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">BaseSyntaxError</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for all errors raised by value parsers.&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="ValueParser"><a class="viewcode-back" href="../../../../../core.util.webpub_manifest_parser.core.html#core.util.webpub_manifest_parser.core.ast.ValueParser">[docs]</a><span class="nd">@six</span><span class="o">.</span><span class="n">add_metaclass</span><span class="p">(</span><span class="n">ABCMeta</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">ValueParser</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base parser class.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="ValueParser.parse"><a class="viewcode-back" href="../../../../../core.util.webpub_manifest_parser.core.html#core.util.webpub_manifest_parser.core.ast.ValueParser.parse">[docs]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Parse the value, raise ParsingError if the value is not correct, otherwise return the processed value.</span>

<span class="sd">        :param value: Value to validate</span>
<span class="sd">        :type value: Any</span>

<span class="sd">        :return: Processed value (for example, datetime object in the case of a value containing a date&amp;time string)</span>
<span class="sd">        :rtype: Any</span>

<span class="sd">        :raise: ValidationError</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="AnyOfParser"><a class="viewcode-back" href="../../../../../core.util.webpub_manifest_parser.core.html#core.util.webpub_manifest_parser.core.ast.AnyOfParser">[docs]</a><span class="k">class</span> <span class="nc">AnyOfParser</span><span class="p">(</span><span class="n">ValueParser</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Parser making sure that at least one of the inner parsers succeed.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inner_parsers</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize a new instance of AnyOfParser class.</span>

<span class="sd">        :param inner_parsers: List of composed parsers</span>
<span class="sd">        :type inner_parsers: List[ValueParser]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_inner_parsers</span> <span class="o">=</span> <span class="n">inner_parsers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">inner_parsers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the inner parsers.</span>

<span class="sd">        :return: Inner parsers</span>
<span class="sd">        :rtype: List[ValueParser]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inner_parsers</span>

<div class="viewcode-block" id="AnyOfParser.parse"><a class="viewcode-back" href="../../../../../core.util.webpub_manifest_parser.core.html#core.util.webpub_manifest_parser.core.ast.AnyOfParser.parse">[docs]</a>    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Make sure that at least one of the inner parsers succeed, otherwise raise the first validation error.</span>

<span class="sd">        :param value: Value</span>
<span class="sd">        :type value: Any</span>

<span class="sd">        :return: First valid value</span>
<span class="sd">        :rtype: Any</span>

<span class="sd">        :raise: ValidationError</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">first_validation_error</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="n">parser</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inner_parsers</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;Running </span><span class="si">{0}</span><span class="s2"> parser&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">parser</span><span class="p">))</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                    <span class="sa">u</span><span class="s2">&quot;Parser </span><span class="si">{0}</span><span class="s2"> succeeded: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="n">encode</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
                <span class="p">)</span>

                <span class="k">return</span> <span class="n">result</span>
            <span class="k">except</span> <span class="n">ValueParsingError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;Parser </span><span class="si">{0}</span><span class="s2"> failed&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">encode</span><span class="p">(</span><span class="n">parser</span><span class="p">)))</span>

                <span class="k">if</span> <span class="n">first_validation_error</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">first_validation_error</span> <span class="o">=</span> <span class="n">error</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;All parsers failed&quot;</span><span class="p">)</span>

        <span class="k">raise</span> <span class="n">first_validation_error</span></div></div>


<div class="viewcode-block" id="NumericParser"><a class="viewcode-back" href="../../../../../core.util.webpub_manifest_parser.core.html#core.util.webpub_manifest_parser.core.ast.NumericParser">[docs]</a><span class="nd">@six</span><span class="o">.</span><span class="n">add_metaclass</span><span class="p">(</span><span class="n">ABCMeta</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">NumericParser</span><span class="p">(</span><span class="n">ValueParser</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Numeric parser.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">minimum</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exclusive_minimum</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">maximum</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exclusive_maximum</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize a new instance of NumericParser class.</span>

<span class="sd">        :param minimum: Minimum value</span>
<span class="sd">        :type minimum: Numeric</span>

<span class="sd">        :param exclusive_minimum: Exclusive minimum value</span>
<span class="sd">        :type exclusive_minimum: Numeric</span>

<span class="sd">        :param maximum: Maximum value</span>
<span class="sd">        :type maximum: Numeric</span>

<span class="sd">        :param exclusive_maximum: Exclusive maximum value</span>
<span class="sd">        :type exclusive_maximum: Numeric</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_minimum</span> <span class="o">=</span> <span class="n">minimum</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_exclusive_minimum</span> <span class="o">=</span> <span class="n">exclusive_minimum</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_maximum</span> <span class="o">=</span> <span class="n">maximum</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_exclusive_maximum</span> <span class="o">=</span> <span class="n">exclusive_maximum</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">_parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Parse a numeric string into a Python numeric object (int or float).</span>

<span class="sd">        :param value: Value</span>
<span class="sd">        :type value: Any</span>

<span class="sd">        :return: Parsed numeric value</span>
<span class="sd">        :rtype: Numeric</span>

<span class="sd">        :raise: ValidationError</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

<div class="viewcode-block" id="NumericParser.parse"><a class="viewcode-back" href="../../../../../core.util.webpub_manifest_parser.core.html#core.util.webpub_manifest_parser.core.ast.NumericParser.parse">[docs]</a>    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Parse a numeric value.</span>

<span class="sd">        :param value: Value</span>
<span class="sd">        :type value: Any</span>

<span class="sd">        :return: Parsed numeric value</span>
<span class="sd">        :rtype: Numeric</span>

<span class="sd">        :raise: ValidationError</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_minimum</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_minimum</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValueParsingError</span><span class="p">(</span>
                <span class="sa">u</span><span class="s2">&quot;Value </span><span class="si">{0}</span><span class="s2"> is less than the minimum (</span><span class="si">{1}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_minimum</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exclusive_minimum</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">value</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exclusive_minimum</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValueParsingError</span><span class="p">(</span>
                <span class="sa">u</span><span class="s2">&quot;Value </span><span class="si">{0}</span><span class="s2"> is less or equal than the exclusive minimum (</span><span class="si">{1}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exclusive_minimum</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maximum</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maximum</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValueParsingError</span><span class="p">(</span>
                <span class="sa">u</span><span class="s2">&quot;Value </span><span class="si">{0}</span><span class="s2"> is greater than the maximum (</span><span class="si">{1}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maximum</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exclusive_maximum</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">value</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exclusive_maximum</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValueParsingError</span><span class="p">(</span>
                <span class="sa">u</span><span class="s2">&quot;Value </span><span class="si">{0}</span><span class="s2"> is greater or equal than the exclusive maximum (</span><span class="si">{1}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exclusive_maximum</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">value</span></div></div>


<div class="viewcode-block" id="IntegerParser"><a class="viewcode-back" href="../../../../../core.util.webpub_manifest_parser.core.html#core.util.webpub_manifest_parser.core.ast.IntegerParser">[docs]</a><span class="k">class</span> <span class="nc">IntegerParser</span><span class="p">(</span><span class="n">NumericParser</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Integer parser.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Parse an integer value.</span>

<span class="sd">        :param value: Value</span>
<span class="sd">        :type value: Any</span>

<span class="sd">        :return: Parsed integer</span>
<span class="sd">        :rtype: int</span>

<span class="sd">        :raise: ValidationError</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValueParsingError</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">error</span><span class="p">),</span> <span class="n">error</span><span class="p">)</span></div>


<div class="viewcode-block" id="NumberParser"><a class="viewcode-back" href="../../../../../core.util.webpub_manifest_parser.core.html#core.util.webpub_manifest_parser.core.ast.NumberParser">[docs]</a><span class="k">class</span> <span class="nc">NumberParser</span><span class="p">(</span><span class="n">NumericParser</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Number parser.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Parse a float number.</span>

<span class="sd">        :param value: Value</span>
<span class="sd">        :type value: Any</span>

<span class="sd">        :return: Parsed float number</span>
<span class="sd">        :rtype: int</span>

<span class="sd">        :raise: ValidationError</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValueParsingError</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">error</span><span class="p">),</span> <span class="n">error</span><span class="p">)</span></div>


<div class="viewcode-block" id="BooleanParser"><a class="viewcode-back" href="../../../../../core.util.webpub_manifest_parser.core.html#core.util.webpub_manifest_parser.core.ast.BooleanParser">[docs]</a><span class="k">class</span> <span class="nc">BooleanParser</span><span class="p">(</span><span class="n">ValueParser</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Boolean parser.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="BooleanParser.parse"><a class="viewcode-back" href="../../../../../core.util.webpub_manifest_parser.core.html#core.util.webpub_manifest_parser.core.ast.BooleanParser.parse">[docs]</a>    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Parse a boolean value.</span>

<span class="sd">        :param value: Value</span>
<span class="sd">        :type value: Any</span>

<span class="sd">        :return: Parsed boolean value</span>
<span class="sd">        :rtype: int</span>

<span class="sd">        :raise: ValidationError</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">value</span>

        <span class="k">if</span> <span class="n">is_string</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;false&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>

            <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>

        <span class="k">raise</span> <span class="n">ValueParsingError</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;Value &#39;</span><span class="si">{0}</span><span class="s2">&#39; must be boolean&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">encode</span><span class="p">(</span><span class="n">value</span><span class="p">)))</span></div></div>


<div class="viewcode-block" id="StringParser"><a class="viewcode-back" href="../../../../../core.util.webpub_manifest_parser.core.html#core.util.webpub_manifest_parser.core.ast.StringParser">[docs]</a><span class="k">class</span> <span class="nc">StringParser</span><span class="p">(</span><span class="n">ValueParser</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;String parser.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="StringParser.parse"><a class="viewcode-back" href="../../../../../core.util.webpub_manifest_parser.core.html#core.util.webpub_manifest_parser.core.ast.StringParser.parse">[docs]</a>    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Parse a string value.</span>

<span class="sd">        :param value: Value</span>
<span class="sd">        :type value: Any</span>

<span class="sd">        :return: Parsed string value</span>
<span class="sd">        :rtype: str</span>

<span class="sd">        :raise: ValidationError</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_string</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ValueParsingError</span><span class="p">(</span>
                <span class="sa">u</span><span class="s2">&quot;Value &#39;</span><span class="si">{0}</span><span class="s2">&#39; must be a string&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">encode</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">value</span></div></div>


<div class="viewcode-block" id="StringPatternParser"><a class="viewcode-back" href="../../../../../core.util.webpub_manifest_parser.core.html#core.util.webpub_manifest_parser.core.ast.StringPatternParser">[docs]</a><span class="k">class</span> <span class="nc">StringPatternParser</span><span class="p">(</span><span class="n">StringParser</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;String parser using a regular expression pattern.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pattern</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize a new instance of StringPatternParser class.</span>

<span class="sd">        :param pattern: Regular expression which string&#39;s value must conform to</span>
<span class="sd">        :type pattern: RegEx</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_string</span><span class="p">(</span><span class="n">pattern</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Pattern argument must be a string&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_pattern</span> <span class="o">=</span> <span class="n">pattern</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span> <span class="k">if</span> <span class="n">pattern</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>

<div class="viewcode-block" id="StringPatternParser.parse"><a class="viewcode-back" href="../../../../../core.util.webpub_manifest_parser.core.html#core.util.webpub_manifest_parser.core.ast.StringPatternParser.parse">[docs]</a>    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Parse a string value using the specified regular expression.</span>

<span class="sd">        :param value: Value</span>
<span class="sd">        :type value: Any</span>

<span class="sd">        :return: Parsed string value</span>
<span class="sd">        :rtype: int</span>

<span class="sd">        :raise: ValidationError</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">StringPatternParser</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_regex</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ValueParsingError</span><span class="p">(</span>
                <span class="sa">u</span><span class="s2">&quot;String value &#39;</span><span class="si">{0}</span><span class="s2">&#39; does not match regular expression </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">encode</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pattern</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">value</span></div></div>


<div class="viewcode-block" id="EnumParser"><a class="viewcode-back" href="../../../../../core.util.webpub_manifest_parser.core.html#core.util.webpub_manifest_parser.core.ast.EnumParser">[docs]</a><span class="k">class</span> <span class="nc">EnumParser</span><span class="p">(</span><span class="n">StringParser</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Enum parser.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">items</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize a new instance of EnumParser class.</span>

<span class="sd">        :param items: Enumeration items</span>
<span class="sd">        :type items: List[str]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_items</span> <span class="o">=</span> <span class="n">items</span>

<div class="viewcode-block" id="EnumParser.parse"><a class="viewcode-back" href="../../../../../core.util.webpub_manifest_parser.core.html#core.util.webpub_manifest_parser.core.ast.EnumParser.parse">[docs]</a>    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Make sure that the value is a part of the enumeration and return it back.</span>

<span class="sd">        :param value: Value</span>
<span class="sd">        :type value: Any</span>

<span class="sd">        :return: Parsed string value</span>
<span class="sd">        :rtype: int</span>

<span class="sd">        :raise: ValidationError</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">EnumParser</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_items</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValueParsingError</span><span class="p">(</span>
                <span class="sa">u</span><span class="s2">&quot;Value &#39;</span><span class="si">{0}</span><span class="s2">&#39; is not among </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">encode</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_items</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">value</span></div></div>


<div class="viewcode-block" id="FormatChecker"><a class="viewcode-back" href="../../../../../core.util.webpub_manifest_parser.core.html#core.util.webpub_manifest_parser.core.ast.FormatChecker">[docs]</a><span class="nd">@six</span><span class="o">.</span><span class="n">add_metaclass</span><span class="p">(</span><span class="n">ABCMeta</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">FormatChecker</span><span class="p">(</span><span class="n">StringParser</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for all parsers using jsonschema FormatChecker.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">json_schema_format</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize a new instance of FormatParser class.</span>

<span class="sd">        :param json_schema_format: One of the jsonschema allowed string formats (color, date, date-time, etc.)</span>
<span class="sd">        :type json_schema_format: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_json_schema_format</span> <span class="o">=</span> <span class="n">json_schema_format</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_format_checker</span> <span class="o">=</span> <span class="n">jsonschema</span><span class="o">.</span><span class="n">FormatChecker</span><span class="p">([</span><span class="n">json_schema_format</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check the value&#39;s format.</span>

<span class="sd">        :param value: Value</span>
<span class="sd">        :type value: Any</span>

<span class="sd">        :raise: ValidationError</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_format_checker</span><span class="o">.</span><span class="n">check</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_json_schema_format</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">FormatError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValueParsingError</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">error</span><span class="p">),</span> <span class="n">error</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Parse the value into an appropriate Python type.</span>

<span class="sd">        :param value: Value</span>
<span class="sd">        :type value: Any</span>

<span class="sd">        :return: Parsed value</span>
<span class="sd">        :rtype: Any</span>

<span class="sd">        :raise: ValidationError</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">value</span>

<div class="viewcode-block" id="FormatChecker.parse"><a class="viewcode-back" href="../../../../../core.util.webpub_manifest_parser.core.html#core.util.webpub_manifest_parser.core.ast.FormatChecker.parse">[docs]</a>    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Parse the value according to the specified format.</span>

<span class="sd">        :param value: Value</span>
<span class="sd">        :type value: Any</span>

<span class="sd">        :return: Parsed value</span>
<span class="sd">        :rtype: Any</span>

<span class="sd">        :raise: ValidationError</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span></div></div>


<div class="viewcode-block" id="URIParser"><a class="viewcode-back" href="../../../../../core.util.webpub_manifest_parser.core.html#core.util.webpub_manifest_parser.core.ast.URIParser">[docs]</a><span class="k">class</span> <span class="nc">URIParser</span><span class="p">(</span><span class="n">FormatChecker</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;URI parser.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize a new instance of URIParser class.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">URIParser</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s2">&quot;uri&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Parse the URI into a Python dictionary containing URI&#39;s subcomponents.</span>

<span class="sd">        :param value: Value</span>
<span class="sd">        :type value: Any</span>

<span class="sd">        :return: URI</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">value</span></div>


<div class="viewcode-block" id="URITemplateParser"><a class="viewcode-back" href="../../../../../core.util.webpub_manifest_parser.core.html#core.util.webpub_manifest_parser.core.ast.URITemplateParser">[docs]</a><span class="k">class</span> <span class="nc">URITemplateParser</span><span class="p">(</span><span class="n">StringParser</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;URI template parser.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="URITemplateParser.parse"><a class="viewcode-back" href="../../../../../core.util.webpub_manifest_parser.core.html#core.util.webpub_manifest_parser.core.ast.URITemplateParser.parse">[docs]</a>    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Parse the URI into a Python dictionary containing URI&#39;s subcomponents.</span>

<span class="sd">        :param value: Value</span>
<span class="sd">        :type value: Any</span>

<span class="sd">        :return: URI template</span>
<span class="sd">        :rtype: URITemplate</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">URITemplate</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">value</span></div></div>


<div class="viewcode-block" id="URIReferenceParser"><a class="viewcode-back" href="../../../../../core.util.webpub_manifest_parser.core.html#core.util.webpub_manifest_parser.core.ast.URIReferenceParser">[docs]</a><span class="k">class</span> <span class="nc">URIReferenceParser</span><span class="p">(</span><span class="n">FormatChecker</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;URI-reference parser.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize a new instance of URIReferenceParser class.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">URIReferenceParser</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s2">&quot;uri-reference&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Parse the URI-reference into a Python dictionary containing URI&#39;s subcomponents.</span>

<span class="sd">        :param value: Value</span>
<span class="sd">        :type value: Any</span>

<span class="sd">        :return: URI-reference</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">value</span></div>


<div class="viewcode-block" id="DateParser"><a class="viewcode-back" href="../../../../../core.util.webpub_manifest_parser.core.html#core.util.webpub_manifest_parser.core.ast.DateParser">[docs]</a><span class="k">class</span> <span class="nc">DateParser</span><span class="p">(</span><span class="n">FormatChecker</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Date parser.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize a new instance of DateParser class.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">DateParser</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Parse a date &amp; time string into datetime object.</span>

<span class="sd">        :param value: Value</span>
<span class="sd">        :type value: Any</span>

<span class="sd">        :return: Parsed date object</span>
<span class="sd">        :rtype: datetime.datetime</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="DateTimeParser"><a class="viewcode-back" href="../../../../../core.util.webpub_manifest_parser.core.html#core.util.webpub_manifest_parser.core.ast.DateTimeParser">[docs]</a><span class="k">class</span> <span class="nc">DateTimeParser</span><span class="p">(</span><span class="n">FormatChecker</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Date &amp; time parser.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize a new instance of DateTimeParser class.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">DateTimeParser</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s2">&quot;date-time&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Parse a date &amp; time string into datetime object.</span>

<span class="sd">        :param value: Value</span>
<span class="sd">        :type value: Any</span>

<span class="sd">        :return: Parsed date &amp; time object</span>
<span class="sd">        :rtype: datetime.datetime</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="n">strict_rfc3339</span><span class="o">.</span><span class="n">rfc3339_to_timestamp</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="n">timestamp</span><span class="p">)</span></div>


<div class="viewcode-block" id="ArrayParser"><a class="viewcode-back" href="../../../../../core.util.webpub_manifest_parser.core.html#core.util.webpub_manifest_parser.core.ast.ArrayParser">[docs]</a><span class="k">class</span> <span class="nc">ArrayParser</span><span class="p">(</span><span class="n">ValueParser</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Array parser.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item_parser</span><span class="p">,</span> <span class="n">unique_items</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize a new instance of ArrayParser class.</span>

<span class="sd">        :param item_parser: Parser used for parsing array items</span>
<span class="sd">        :type item_parser: ValueParser</span>

<span class="sd">        :param unique_items: Boolean value indicating whether array must contain only unique items</span>
<span class="sd">        :type unique_items: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_item_parser</span> <span class="o">=</span> <span class="n">item_parser</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_unique_items</span> <span class="o">=</span> <span class="n">unique_items</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">item_parser</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the parser used for parsing array items.</span>

<span class="sd">        :return: Parser used for parsing array items</span>
<span class="sd">        :rtype: ValueParser</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_item_parser</span>

<div class="viewcode-block" id="ArrayParser.parse"><a class="viewcode-back" href="../../../../../core.util.webpub_manifest_parser.core.html#core.util.webpub_manifest_parser.core.ast.ArrayParser.parse">[docs]</a>    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Parse the value into a list of parsed values.</span>

<span class="sd">        :param value: Value</span>
<span class="sd">        :type value: Any</span>

<span class="sd">        :return: List consisting of parsed items</span>
<span class="sd">        :rtype: List</span>

<span class="sd">        :raise: ValidationError</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ValueParsingError</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;Value &#39;</span><span class="si">{0}</span><span class="s2">&#39; must be a list&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">encode</span><span class="p">(</span><span class="n">value</span><span class="p">)))</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">seen</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
            <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_item_parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unique_items</span> <span class="ow">and</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ValueParsingError</span><span class="p">(</span>
                    <span class="sa">u</span><span class="s2">&quot;Item &#39;</span><span class="si">{0}</span><span class="s2">&#39; is not unique&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">encode</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
                <span class="p">)</span>

            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="n">seen</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">result</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="ObjectParser"><a class="viewcode-back" href="../../../../../core.util.webpub_manifest_parser.core.html#core.util.webpub_manifest_parser.core.ast.ObjectParser">[docs]</a><span class="k">class</span> <span class="nc">ObjectParser</span><span class="p">(</span><span class="n">ValueParser</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Object parser.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">properties_parser</span><span class="p">,</span> <span class="n">properties_pattern</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize a new instance of ObjectParser class.</span>

<span class="sd">        :param properties_parser: Properties parser</span>
<span class="sd">        :type properties_parser: ValueParser</span>

<span class="sd">        :param properties_pattern: Properties regex pattern</span>
<span class="sd">        :type properties_pattern: Optional[str]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_properties_parser</span> <span class="o">=</span> <span class="n">properties_parser</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_properties_regex</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">properties_pattern</span><span class="p">)</span> <span class="k">if</span> <span class="n">properties_pattern</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="p">)</span>

<div class="viewcode-block" id="ObjectParser.parse"><a class="viewcode-back" href="../../../../../core.util.webpub_manifest_parser.core.html#core.util.webpub_manifest_parser.core.ast.ObjectParser.parse">[docs]</a>    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Parse a JSON object into a Python dictionary.</span>

<span class="sd">        :param value: Value</span>
<span class="sd">        :type value: Any</span>

<span class="sd">        :return: Python dictionary containing parsed items</span>
<span class="sd">        :rtype: Dict</span>

<span class="sd">        :raise: ValidationError</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ValueParsingError</span><span class="p">(</span><span class="s2">&quot;Value must be a dictionary&quot;</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">ValueParsingError</span><span class="p">(</span>
                    <span class="sa">u</span><span class="s2">&quot;Key &#39;</span><span class="si">{0}</span><span class="s2">&#39; must be a string&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">encode</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_properties_regex</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_properties_regex</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">ValueParsingError</span><span class="p">(</span>
                    <span class="sa">u</span><span class="s2">&quot;Key &#39;</span><span class="si">{0}</span><span class="s2">&#39; does not match the pattern &#39;</span><span class="si">{1}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">encode</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_properties_regex</span>
                    <span class="p">)</span>
                <span class="p">)</span>

            <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_properties_parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

            <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span>

        <span class="k">return</span> <span class="n">result</span></div></div>


<div class="viewcode-block" id="LocalizableStringParser"><a class="viewcode-back" href="../../../../../core.util.webpub_manifest_parser.core.html#core.util.webpub_manifest_parser.core.ast.LocalizableStringParser">[docs]</a><span class="k">class</span> <span class="nc">LocalizableStringParser</span><span class="p">(</span><span class="n">ObjectParser</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Parser for localizable strings represented as a dictionary with keys equal to language codes.&quot;&quot;&quot;</span>

    <span class="n">LANGUAGE_PATTERN</span> <span class="o">=</span> <span class="s2">&quot;^((?P&lt;grandfathered&gt;(en-GB-oed|i-ami|i-bnn|i-default|i-enochian|i-hak|i-klingon|i-lux|i-mingo|i-navajo|i-pwn|i-tao|i-tay|i-tsu|sgn-BE-FR|sgn-BE-NL|sgn-CH-DE)|(art-lojban|cel-gaulish|no-bok|no-nyn|zh-guoyu|zh-hakka|zh-min|zh-min-nan|zh-xiang))|((?P&lt;language&gt;([A-Za-z]{2,3}(-(?P&lt;extlang&gt;[A-Za-z]</span><span class="si">{3}</span><span class="s2">(-[A-Za-z]</span><span class="si">{3}</span><span class="s2">){0,2}))?)|[A-Za-z]</span><span class="si">{4}</span><span class="s2">|[A-Za-z]{5,8})(-(?P&lt;script&gt;[A-Za-z]</span><span class="si">{4}</span><span class="s2">))?(-(?P&lt;region&gt;[A-Za-z]</span><span class="si">{2}</span><span class="s2">|[0-9]</span><span class="si">{3}</span><span class="s2">))?(-(?P&lt;variant&gt;[A-Za-z0-9]{5,8}|[0-9][A-Za-z0-9]</span><span class="si">{3}</span><span class="s2">))*(-(?P&lt;extension&gt;[0-9A-WY-Za-wy-z](-[A-Za-z0-9]{2,8})+))*(-(?P&lt;privateUse&gt;x(-[A-Za-z0-9]{1,8})+))?)|(?P&lt;privateUse2&gt;x(-[A-Za-z0-9]{1,8})+))$&quot;</span>  <span class="c1"># noqa: E501, pylint: disable=C0301</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize a new instance of LocalizableStringValidator class.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">LocalizableStringParser</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">StringParser</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">LANGUAGE_PATTERN</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TypeParser"><a class="viewcode-back" href="../../../../../core.util.webpub_manifest_parser.core.html#core.util.webpub_manifest_parser.core.ast.TypeParser">[docs]</a><span class="k">class</span> <span class="nc">TypeParser</span><span class="p">(</span><span class="n">ValueParser</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Parser used for checking type information and as an indication of nested types.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize a new instance of TypeParser class.</span>

<span class="sd">        :param _type: Type</span>
<span class="sd">        :type _type: Union[Type, str]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">=</span> <span class="n">_type</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the type.</span>

<span class="sd">        &quot;return: Type</span>
<span class="sd">        :rtype: Type</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">is_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_type</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">=</span> <span class="n">locate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_type</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;Unknown type </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_type</span><span class="p">))</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span>

<div class="viewcode-block" id="TypeParser.parse"><a class="viewcode-back" href="../../../../../core.util.webpub_manifest_parser.core.html#core.util.webpub_manifest_parser.core.ast.TypeParser.parse">[docs]</a>    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check that the value has the correct type.</span>

<span class="sd">        :param value: Value</span>
<span class="sd">        :type value: Any</span>

<span class="sd">        :return: Value</span>
<span class="sd">        :rtype: Any</span>

<span class="sd">        :raise: ValidationError</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ValueParsingError</span><span class="p">(</span>
                <span class="sa">u</span><span class="s2">&quot;Value &#39;</span><span class="si">{0}</span><span class="s2">&#39; must be an instance of &#39;</span><span class="si">{1}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">encode</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">value</span></div></div>


<div class="viewcode-block" id="find_parser"><a class="viewcode-back" href="../../../../../core.util.webpub_manifest_parser.core.html#core.util.webpub_manifest_parser.core.ast.find_parser">[docs]</a><span class="k">def</span> <span class="nf">find_parser</span><span class="p">(</span><span class="n">parent_parser</span><span class="p">,</span> <span class="n">child_parser_type</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Find a child parser with a specified type in the parent parser.</span>

<span class="sd">    This function is used for finding nested types.</span>

<span class="sd">    :param parent_parser: Parent parser</span>
<span class="sd">    :type parent_parser: ValueParser</span>

<span class="sd">    :param child_parser_type: Child parser&#39;s type</span>
<span class="sd">    :type child_parser_type: Type</span>

<span class="sd">    :return: List of 2-tuples (parent parser, child parser)</span>
<span class="sd">    :rtype: List[Optional[ValueParser], ValueParser]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">candidates</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">_find_parser</span><span class="p">(</span><span class="n">_parent_parser</span><span class="p">,</span> <span class="n">_current_parser</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">_current_parser</span><span class="p">,</span> <span class="n">child_parser_type</span><span class="p">):</span>
            <span class="n">candidates</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">_parent_parser</span><span class="p">,</span> <span class="n">_current_parser</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">_current_parser</span><span class="p">,</span> <span class="n">AnyOfParser</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">inner_parser</span> <span class="ow">in</span> <span class="n">_current_parser</span><span class="o">.</span><span class="n">inner_parsers</span><span class="p">:</span>
                <span class="n">_find_parser</span><span class="p">(</span><span class="n">_parent_parser</span><span class="p">,</span> <span class="n">inner_parser</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">_current_parser</span><span class="p">,</span> <span class="n">ArrayParser</span><span class="p">):</span>
            <span class="n">_find_parser</span><span class="p">(</span><span class="n">_current_parser</span><span class="p">,</span> <span class="n">_current_parser</span><span class="o">.</span><span class="n">item_parser</span><span class="p">)</span>

    <span class="n">_find_parser</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">parent_parser</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">candidates</span></div>


<div class="viewcode-block" id="DocumentParser"><a class="viewcode-back" href="../../../../../core.util.webpub_manifest_parser.core.html#core.util.webpub_manifest_parser.core.ast.DocumentParser">[docs]</a><span class="k">class</span> <span class="nc">DocumentParser</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for RWPM-compatible parsers.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">syntax_analyzer</span><span class="p">,</span> <span class="n">semantic_analyzer</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize a new instance of Parser class.</span>

<span class="sd">        :param syntax_analyzer: Syntax analyzer</span>
<span class="sd">        :type syntax_analyzer: syntax.SyntaxAnalyzer</span>

<span class="sd">        :param semantic_analyzer: Semantic analyser</span>
<span class="sd">        :type semantic_analyzer: semantic.SemanticAnalyzer</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_syntax_analyzer</span> <span class="o">=</span> <span class="n">syntax_analyzer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_semantic_analyzer</span> <span class="o">=</span> <span class="n">semantic_analyzer</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<div class="viewcode-block" id="DocumentParser.parse_file"><a class="viewcode-back" href="../../../../../core.util.webpub_manifest_parser.core.html#core.util.webpub_manifest_parser.core.ast.DocumentParser.parse_file">[docs]</a>    <span class="k">def</span> <span class="nf">parse_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_file_path</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Parse the input file and return a validated AST object.</span>

<span class="sd">        :param input_file_path: Full path to the file containing RWPM-compatible document</span>
<span class="sd">        :type input_file_path: str</span>

<span class="sd">        :param encoding: Input file&#39;s encoding</span>
<span class="sd">        :type encoding: str</span>

<span class="sd">        :return: Validated manifest-like object</span>
<span class="sd">        :rtype: python_rwpm_parser.ast.Manifestlike</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">io</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">input_file_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span> <span class="k">as</span> <span class="n">input_file</span><span class="p">:</span>
            <span class="n">manifest_json</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_manifest_json</span><span class="p">(</span><span class="n">input_file</span><span class="p">)</span>
            <span class="n">manifest</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_syntax_analyzer</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span><span class="n">manifest_json</span><span class="p">)</span>
            <span class="n">manifest</span><span class="o">.</span><span class="n">accept</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_semantic_analyzer</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">manifest</span></div>

<div class="viewcode-block" id="DocumentParser.parse_stream"><a class="viewcode-back" href="../../../../../core.util.webpub_manifest_parser.core.html#core.util.webpub_manifest_parser.core.ast.DocumentParser.parse_stream">[docs]</a>    <span class="k">def</span> <span class="nf">parse_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_stream</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Parse the input file and return a validated AST object.</span>

<span class="sd">        :param input_stream: Full path to the file containing RWPM-compatible document</span>
<span class="sd">        :type input_stream: six.StringIO</span>

<span class="sd">        :return: Validated manifest-like object</span>
<span class="sd">        :rtype: python_rwpm_parser.ast.Manifestlike</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">manifest_json</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_manifest_json</span><span class="p">(</span><span class="n">input_stream</span><span class="p">)</span>
        <span class="n">manifest</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_syntax_analyzer</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span><span class="n">manifest_json</span><span class="p">)</span>
        <span class="n">manifest</span><span class="o">.</span><span class="n">accept</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_semantic_analyzer</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">manifest</span></div>

<div class="viewcode-block" id="DocumentParser.parse_url"><a class="viewcode-back" href="../../../../../core.util.webpub_manifest_parser.core.html#core.util.webpub_manifest_parser.core.ast.DocumentParser.parse_url">[docs]</a>    <span class="k">def</span> <span class="nf">parse_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Fetch the content pointed by the URL, parse it and return a validated AST object.</span>

<span class="sd">        :param url: URL pointing to the RWPM-compatible document</span>
<span class="sd">        :type url: str</span>

<span class="sd">        :param encoding: Input file&#39;s encoding</span>
<span class="sd">        :type encoding: str</span>

<span class="sd">        :return: Validated manifest-like object</span>
<span class="sd">        :rtype: python_rwpm_parser.ast.Manifestlike</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">input_stream</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">(</span><span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="n">encoding</span><span class="p">))</span>
        <span class="n">manifest_json</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_manifest_json</span><span class="p">(</span><span class="n">input_stream</span><span class="p">)</span>
        <span class="n">manifest</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_syntax_analyzer</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span><span class="n">manifest_json</span><span class="p">)</span>
        <span class="n">manifest</span><span class="o">.</span><span class="n">accept</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_semantic_analyzer</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">manifest</span></div>

<div class="viewcode-block" id="DocumentParser.parse_json"><a class="viewcode-back" href="../../../../../core.util.webpub_manifest_parser.core.html#core.util.webpub_manifest_parser.core.ast.DocumentParser.parse_json">[docs]</a>    <span class="k">def</span> <span class="nf">parse_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">manifest_json</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Parse the JSON document with an RWPM-compatible manifest and return a validated AST object.</span>

<span class="sd">        :param manifest_json: JSON document with an RWPM-compatible manifest</span>
<span class="sd">        :type manifest_json: Dict</span>

<span class="sd">        :return: Validated manifest-like object</span>
<span class="sd">        :rtype: python_rwpm_parser.ast.Manifestlike</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">manifest</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_syntax_analyzer</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span><span class="n">manifest_json</span><span class="p">)</span>
        <span class="n">manifest</span><span class="o">.</span><span class="n">accept</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_semantic_analyzer</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">manifest</span></div>

<div class="viewcode-block" id="DocumentParser.get_manifest_json"><a class="viewcode-back" href="../../../../../core.util.webpub_manifest_parser.core.html#core.util.webpub_manifest_parser.core.ast.DocumentParser.get_manifest_json">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_manifest_json</span><span class="p">(</span><span class="n">input_stream</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Parse the input stream into a JSON document containing an RWPM-compatible manifest.</span>

<span class="sd">        :param input_stream: Input stream containing JSON document with an RWPM-compatible manifest</span>
<span class="sd">        :type input_stream: Union[six.StringIO, six.BinaryIO]</span>

<span class="sd">        :return: JSON document containing an RWPM-compatible manifest</span>
<span class="sd">        :rtype: Dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Started parsing input stream into a JSON document&quot;</span><span class="p">)</span>

        <span class="n">input_stream_content</span> <span class="o">=</span> <span class="n">input_stream</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">input_stream_content</span> <span class="o">=</span> <span class="n">input_stream_content</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">manifest_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">input_stream_content</span><span class="p">)</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Finished parsing input stream into a JSON document&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">manifest_json</span></div></div>


<div class="viewcode-block" id="DocumentParserFactory"><a class="viewcode-back" href="../../../../../core.util.webpub_manifest_parser.core.html#core.util.webpub_manifest_parser.core.ast.DocumentParserFactory">[docs]</a><span class="nd">@six</span><span class="o">.</span><span class="n">add_metaclass</span><span class="p">(</span><span class="n">ABCMeta</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">DocumentParserFactory</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for factories creating parsers for particular RWPM-compatible standards (for example, OPDS 2.0).&quot;&quot;&quot;</span>

<div class="viewcode-block" id="DocumentParserFactory.create"><a class="viewcode-back" href="../../../../../core.util.webpub_manifest_parser.core.html#core.util.webpub_manifest_parser.core.ast.DocumentParserFactory.create">[docs]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a new Parser instance.</span>

<span class="sd">        :return: Parser instance</span>
<span class="sd">        :rtype: DocumentParser</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div></div>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../../../index.html">Library Simplified Circulation Manager</a></h1>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../modules.html">circulation</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../../../index.html">Documentation overview</a><ul>
  <li><a href="../../../../index.html">Module code</a><ul>
  <li><a href="../../../util.html">core.util</a><ul>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, The New York Public Library, Astor, Lenox, and Tilden Foundations.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 5.0.0b1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
    </div>

    

    
  </body>
</html>