
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>api.routes &#8212; Library Simplified Circulation Manager  documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for api.routes</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">nose.tools</span> <span class="kn">import</span> <span class="n">set_trace</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span><span class="p">,</span> <span class="n">update_wrapper</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">import</span> <span class="nn">flask</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">Response</span><span class="p">,</span>
    <span class="n">redirect</span><span class="p">,</span>
    <span class="n">request</span><span class="p">,</span>
    <span class="n">make_response</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">flask_cors.core</span> <span class="kn">import</span> <span class="n">get_cors_options</span><span class="p">,</span> <span class="n">set_cors_headers</span>
<span class="kn">from</span> <span class="nn">werkzeug.exceptions</span> <span class="kn">import</span> <span class="n">HTTPException</span>

<span class="kn">from</span> <span class="nn">app</span> <span class="kn">import</span> <span class="n">app</span><span class="p">,</span> <span class="n">babel</span>

<span class="c1"># We use URIs as identifiers throughout the application, meaning that</span>
<span class="c1"># we never want werkzeug&#39;s merge_slashes feature.</span>
<span class="n">app</span><span class="o">.</span><span class="n">url_map</span><span class="o">.</span><span class="n">merge_slashes</span> <span class="o">=</span> <span class="kc">False</span>

<span class="kn">from</span> <span class="nn">config</span> <span class="kn">import</span> <span class="n">Configuration</span>
<span class="kn">from</span> <span class="nn">core.app_server</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">ErrorHandler</span><span class="p">,</span>
    <span class="n">compressible</span><span class="p">,</span>
    <span class="n">returns_problem_detail</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">core.model</span> <span class="kn">import</span> <span class="n">ConfigurationSetting</span>
<span class="kn">from</span> <span class="nn">core.util.problem_detail</span> <span class="kn">import</span> <span class="n">ProblemDetail</span>
<span class="kn">from</span> <span class="nn">controller</span> <span class="kn">import</span> <span class="n">CirculationManager</span>
<span class="kn">from</span> <span class="nn">problem_details</span> <span class="kn">import</span> <span class="n">REMOTE_INTEGRATION_FAILED</span>
<span class="kn">from</span> <span class="nn">flask_babel</span> <span class="kn">import</span> <span class="n">lazy_gettext</span> <span class="k">as</span> <span class="n">_</span>

<div class="viewcode-block" id="initialize_circulation_manager"><a class="viewcode-back" href="../../api.html#api.routes.initialize_circulation_manager">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">before_first_request</span>
<span class="k">def</span> <span class="nf">initialize_circulation_manager</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;AUTOINITIALIZE&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;False&quot;</span><span class="p">:</span>
        <span class="c1"># It&#39;s the responsibility of the importing code to set app.manager</span>
        <span class="c1"># appropriately.</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="s1">&#39;manager&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">app</span><span class="o">.</span><span class="n">manager</span> <span class="o">=</span> <span class="n">CirculationManager</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">_db</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="s2">&quot;Error instantiating circulation manager!&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="n">e</span>
                <span class="p">)</span>
                <span class="k">raise</span> <span class="n">e</span>
            <span class="c1"># Make sure that any changes to the database (as might happen</span>
            <span class="c1"># on initial setup) are committed before continuing.</span>
            <span class="n">app</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">_db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span></div>

<div class="viewcode-block" id="get_locale"><a class="viewcode-back" href="../../api.html#api.routes.get_locale">[docs]</a><span class="nd">@babel</span><span class="o">.</span><span class="n">localeselector</span>
<span class="k">def</span> <span class="nf">get_locale</span><span class="p">():</span>
    <span class="n">languages</span> <span class="o">=</span> <span class="n">Configuration</span><span class="o">.</span><span class="n">localization_languages</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">request</span><span class="o">.</span><span class="n">accept_languages</span><span class="o">.</span><span class="n">best_match</span><span class="p">(</span><span class="n">languages</span><span class="p">)</span></div>

<div class="viewcode-block" id="shutdown_session"><a class="viewcode-back" href="../../api.html#api.routes.shutdown_session">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">teardown_request</span>
<span class="k">def</span> <span class="nf">shutdown_session</span><span class="p">(</span><span class="n">exception</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="s1">&#39;manager&#39;</span><span class="p">)</span>
        <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">manager</span><span class="p">,</span> <span class="s1">&#39;_db&#39;</span><span class="p">)</span>
        <span class="ow">and</span> <span class="n">app</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">_db</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="n">exception</span><span class="p">:</span>
            <span class="n">app</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">_db</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">app</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">_db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span></div>

<div class="viewcode-block" id="requires_auth"><a class="viewcode-back" href="../../api.html#api.routes.requires_auth">[docs]</a><span class="k">def</span> <span class="nf">requires_auth</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">decorated</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">patron</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">index_controller</span><span class="o">.</span><span class="n">authenticated_patron_from_request</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">patron</span><span class="p">,</span> <span class="n">ProblemDetail</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">patron</span><span class="o">.</span><span class="n">response</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">patron</span><span class="p">,</span> <span class="n">Response</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">patron</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">decorated</span></div>

<div class="viewcode-block" id="allows_auth"><a class="viewcode-back" href="../../api.html#api.routes.allows_auth">[docs]</a><span class="k">def</span> <span class="nf">allows_auth</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Decorator function for a controller method that supports both</span>
<span class="sd">    authenticated and unauthenticated requests.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">decorated</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># Try to authenticate a patron. This will set flask.request.patron</span>
        <span class="c1"># if and only if there is an authenticated patron.</span>
        <span class="n">app</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">index_controller</span><span class="o">.</span><span class="n">authenticated_patron_from_request</span><span class="p">()</span>

        <span class="c1"># Call the decorated function regardless of whether</span>
        <span class="c1"># authentication succeeds.</span>
        <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">decorated</span></div>

<span class="c1"># The allows_patron_web decorator will add Cross-Origin Resource Sharing</span>
<span class="c1"># (CORS) headers to routes that will be used by the patron web interface.</span>
<span class="c1"># This is necessary for a JS app on a different domain to make requests.</span>
<span class="c1">#</span>
<span class="c1"># This is mostly taken from the cross_origin decorator in flask_cors, but we</span>
<span class="c1"># can&#39;t use that decorator because we aren&#39;t able to look up the patron web</span>
<span class="c1"># client url configuration setting at the time we create the decorator.</span>
<div class="viewcode-block" id="allows_patron_web"><a class="viewcode-back" href="../../api.html#api.routes.allows_patron_web">[docs]</a><span class="k">def</span> <span class="nf">allows_patron_web</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="c1"># Override Flask&#39;s default behavior and intercept the OPTIONS method for</span>
    <span class="c1"># every request so CORS headers can be added.</span>
    <span class="n">f</span><span class="o">.</span><span class="n">required_methods</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s1">&#39;required_methods&#39;</span><span class="p">,</span> <span class="nb">set</span><span class="p">())</span>
    <span class="n">f</span><span class="o">.</span><span class="n">required_methods</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;OPTIONS&quot;</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">provide_automatic_options</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">wrapped_function</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;OPTIONS&quot;</span><span class="p">:</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">make_default_options_response</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="n">make_response</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>

        <span class="n">patron_web_domains</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">patron_web_domains</span>
        <span class="k">if</span> <span class="n">patron_web_domains</span><span class="p">:</span>
            <span class="n">options</span> <span class="o">=</span> <span class="n">get_cors_options</span><span class="p">(</span>
                <span class="n">app</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">origins</span><span class="o">=</span><span class="n">patron_web_domains</span><span class="p">,</span>
                          <span class="n">supports_credentials</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">set_cors_headers</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">resp</span>
    <span class="k">return</span> <span class="n">update_wrapper</span><span class="p">(</span><span class="n">wrapped_function</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span></div>

<span class="n">h</span> <span class="o">=</span> <span class="n">ErrorHandler</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;DEBUG&#39;</span><span class="p">])</span>
<div class="viewcode-block" id="exception_handler"><a class="viewcode-back" href="../../api.html#api.routes.exception_handler">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">errorhandler</span><span class="p">(</span><span class="ne">Exception</span><span class="p">)</span>
<span class="nd">@allows_patron_web</span>
<span class="k">def</span> <span class="nf">exception_handler</span><span class="p">(</span><span class="n">exception</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exception</span><span class="p">,</span> <span class="n">HTTPException</span><span class="p">):</span>
        <span class="c1"># This isn&#39;t an exception we need to handle, it&#39;s werkzeug&#39;s way</span>
        <span class="c1"># of interrupting normal control flow with a specific HTTP response.</span>
        <span class="c1"># Return the exception and it will be used as the response.</span>
        <span class="k">return</span> <span class="n">exception</span>
    <span class="k">return</span> <span class="n">h</span><span class="o">.</span><span class="n">handle</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span></div>

<div class="viewcode-block" id="has_library"><a class="viewcode-back" href="../../api.html#api.routes.has_library">[docs]</a><span class="k">def</span> <span class="nf">has_library</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Decorator to extract the library short name from the arguments.&quot;&quot;&quot;</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">decorated</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;library_short_name&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">library_short_name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;library_short_name&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">library_short_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">library</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">index_controller</span><span class="o">.</span><span class="n">library_for_request</span><span class="p">(</span><span class="n">library_short_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">library</span><span class="p">,</span> <span class="n">ProblemDetail</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">library</span><span class="o">.</span><span class="n">response</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">decorated</span></div>

<div class="viewcode-block" id="allows_library"><a class="viewcode-back" href="../../api.html#api.routes.allows_library">[docs]</a><span class="k">def</span> <span class="nf">allows_library</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Decorator similar to @has_library but if there is no library short name,</span>
<span class="sd">    then don&#39;t set the request library.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">decorated</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;library_short_name&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">library_short_name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;library_short_name&quot;</span><span class="p">)</span>
            <span class="n">library</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">index_controller</span><span class="o">.</span><span class="n">library_for_request</span><span class="p">(</span><span class="n">library_short_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">library</span><span class="p">,</span> <span class="n">ProblemDetail</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">library</span><span class="o">.</span><span class="n">response</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">library</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">decorated</span></div>

<div class="viewcode-block" id="library_route"><a class="viewcode-back" href="../../api.html#api.routes.library_route">[docs]</a><span class="k">def</span> <span class="nf">library_route</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Decorator to creates routes that have a library short name in either</span>
<span class="sd">    a subdomain or a url path prefix. If not used with @has_library, the view function</span>
<span class="sd">    must have a library_short_name argument.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
        <span class="c1"># This sets up routes for both the subdomain and the url path prefix.</span>
        <span class="c1"># The order of these determines which one will be used by url_for -</span>
        <span class="c1"># in this case it&#39;s the prefix route.</span>
        <span class="c1"># We may want to have a configuration option to specify whether to</span>
        <span class="c1"># use a subdomain or a url path prefix.</span>
        <span class="n">prefix_route</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/&lt;library_short_name&gt;&quot;</span> <span class="o">+</span> <span class="n">path</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">subdomain_route</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">subdomain</span><span class="o">=</span><span class="s2">&quot;&lt;library_short_name&gt;&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)(</span><span class="n">prefix_route</span><span class="p">)</span>
        <span class="n">default_library_route</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)(</span><span class="n">subdomain_route</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">default_library_route</span>
    <span class="k">return</span> <span class="n">decorator</span></div>

<div class="viewcode-block" id="library_dir_route"><a class="viewcode-back" href="../../api.html#api.routes.library_dir_route">[docs]</a><span class="k">def</span> <span class="nf">library_dir_route</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Decorator to create library routes that work with or without a</span>
<span class="sd">    trailing slash.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">):</span>
        <span class="n">path_without_slash</span> <span class="o">=</span> <span class="n">path</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">path_without_slash</span> <span class="o">=</span> <span class="n">path</span>

    <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
        <span class="c1"># By default, creating a route with a slash will make flask redirect</span>
        <span class="c1"># requests without the slash, even if that route also exists.</span>
        <span class="c1"># Setting strict_slashes to False disables this behavior.</span>
        <span class="c1"># This is important for CORS because the redirects are not processed</span>
        <span class="c1"># by the CORS decorator and won&#39;t be valid CORS responses.</span>

        <span class="c1"># Decorate f with four routes, with and without the slash, with a prefix or subdomain</span>
        <span class="n">prefix_slash</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/&lt;library_short_name&gt;&quot;</span> <span class="o">+</span> <span class="n">path_without_slash</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">strict_slashes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">prefix_no_slash</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/&lt;library_short_name&gt;&quot;</span> <span class="o">+</span> <span class="n">path_without_slash</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)(</span><span class="n">prefix_slash</span><span class="p">)</span>
        <span class="n">subdomain_slash</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="n">path_without_slash</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">strict_slashes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">subdomain</span><span class="o">=</span><span class="s2">&quot;&lt;library_short_name&gt;&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)(</span><span class="n">prefix_no_slash</span><span class="p">)</span>
        <span class="n">subdomain_no_slash</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="n">path_without_slash</span><span class="p">,</span> <span class="n">subdomain</span><span class="o">=</span><span class="s2">&quot;&lt;library_short_name&gt;&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)(</span><span class="n">subdomain_slash</span><span class="p">)</span>
        <span class="n">default_library_slash</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="n">path_without_slash</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)(</span><span class="n">subdomain_no_slash</span><span class="p">)</span>
        <span class="n">default_library_no_slash</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="n">path_without_slash</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)(</span><span class="n">default_library_slash</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">default_library_no_slash</span>
    <span class="k">return</span> <span class="n">decorator</span></div>

<div class="viewcode-block" id="index"><a class="viewcode-back" href="../../api.html#api.routes.index">[docs]</a><span class="nd">@library_route</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">strict_slashes</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="nd">@has_library</span>
<span class="nd">@allows_patron_web</span>
<span class="nd">@returns_problem_detail</span>
<span class="nd">@compressible</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">app</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">index_controller</span><span class="p">()</span></div>

<div class="viewcode-block" id="authentication_document"><a class="viewcode-back" href="../../api.html#api.routes.authentication_document">[docs]</a><span class="nd">@library_route</span><span class="p">(</span><span class="s1">&#39;/authentication_document&#39;</span><span class="p">)</span>
<span class="nd">@has_library</span>
<span class="nd">@returns_problem_detail</span>
<span class="nd">@compressible</span>
<span class="k">def</span> <span class="nf">authentication_document</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">app</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">index_controller</span><span class="o">.</span><span class="n">authentication_document</span><span class="p">()</span></div>

<div class="viewcode-block" id="public_key_document"><a class="viewcode-back" href="../../api.html#api.routes.public_key_document">[docs]</a><span class="nd">@library_route</span><span class="p">(</span><span class="s1">&#39;/public_key_document&#39;</span><span class="p">)</span>
<span class="nd">@returns_problem_detail</span>
<span class="nd">@compressible</span>
<span class="k">def</span> <span class="nf">public_key_document</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">app</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">index_controller</span><span class="o">.</span><span class="n">public_key_document</span><span class="p">()</span></div>

<div class="viewcode-block" id="acquisition_groups"><a class="viewcode-back" href="../../api.html#api.routes.acquisition_groups">[docs]</a><span class="nd">@library_dir_route</span><span class="p">(</span><span class="s1">&#39;/groups&#39;</span><span class="p">,</span> <span class="n">defaults</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">lane_identifier</span><span class="o">=</span><span class="kc">None</span><span class="p">))</span>
<span class="nd">@library_route</span><span class="p">(</span><span class="s1">&#39;/groups/&lt;lane_identifier&gt;&#39;</span><span class="p">)</span>
<span class="nd">@has_library</span>
<span class="nd">@allows_patron_web</span>
<span class="nd">@returns_problem_detail</span>
<span class="nd">@compressible</span>
<span class="k">def</span> <span class="nf">acquisition_groups</span><span class="p">(</span><span class="n">lane_identifier</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">app</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">opds_feeds</span><span class="o">.</span><span class="n">groups</span><span class="p">(</span><span class="n">lane_identifier</span><span class="p">)</span></div>

<div class="viewcode-block" id="feed"><a class="viewcode-back" href="../../api.html#api.routes.feed">[docs]</a><span class="nd">@library_dir_route</span><span class="p">(</span><span class="s1">&#39;/feed&#39;</span><span class="p">,</span> <span class="n">defaults</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">lane_identifier</span><span class="o">=</span><span class="kc">None</span><span class="p">))</span>
<span class="nd">@library_route</span><span class="p">(</span><span class="s1">&#39;/feed/&lt;lane_identifier&gt;&#39;</span><span class="p">)</span>
<span class="nd">@has_library</span>
<span class="nd">@allows_patron_web</span>
<span class="nd">@returns_problem_detail</span>
<span class="nd">@compressible</span>
<span class="k">def</span> <span class="nf">feed</span><span class="p">(</span><span class="n">lane_identifier</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">app</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">opds_feeds</span><span class="o">.</span><span class="n">feed</span><span class="p">(</span><span class="n">lane_identifier</span><span class="p">)</span></div>

<div class="viewcode-block" id="navigation_feed"><a class="viewcode-back" href="../../api.html#api.routes.navigation_feed">[docs]</a><span class="nd">@library_dir_route</span><span class="p">(</span><span class="s1">&#39;/navigation&#39;</span><span class="p">,</span> <span class="n">defaults</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">lane_identifier</span><span class="o">=</span><span class="kc">None</span><span class="p">))</span>
<span class="nd">@library_route</span><span class="p">(</span><span class="s1">&#39;/navigation/&lt;lane_identifier&gt;&#39;</span><span class="p">)</span>
<span class="nd">@has_library</span>
<span class="nd">@allows_patron_web</span>
<span class="nd">@returns_problem_detail</span>
<span class="nd">@compressible</span>
<span class="k">def</span> <span class="nf">navigation_feed</span><span class="p">(</span><span class="n">lane_identifier</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">app</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">opds_feeds</span><span class="o">.</span><span class="n">navigation</span><span class="p">(</span><span class="n">lane_identifier</span><span class="p">)</span></div>

<div class="viewcode-block" id="crawlable_library_feed"><a class="viewcode-back" href="../../api.html#api.routes.crawlable_library_feed">[docs]</a><span class="nd">@library_route</span><span class="p">(</span><span class="s1">&#39;/crawlable&#39;</span><span class="p">)</span>
<span class="nd">@has_library</span>
<span class="nd">@allows_patron_web</span>
<span class="nd">@returns_problem_detail</span>
<span class="nd">@compressible</span>
<span class="k">def</span> <span class="nf">crawlable_library_feed</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">app</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">opds_feeds</span><span class="o">.</span><span class="n">crawlable_library_feed</span><span class="p">()</span></div>

<div class="viewcode-block" id="crawlable_list_feed"><a class="viewcode-back" href="../../api.html#api.routes.crawlable_list_feed">[docs]</a><span class="nd">@library_route</span><span class="p">(</span><span class="s1">&#39;/lists/&lt;list_name&gt;/crawlable&#39;</span><span class="p">)</span>
<span class="nd">@has_library</span>
<span class="nd">@allows_patron_web</span>
<span class="nd">@returns_problem_detail</span>
<span class="nd">@compressible</span>
<span class="k">def</span> <span class="nf">crawlable_list_feed</span><span class="p">(</span><span class="n">list_name</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">app</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">opds_feeds</span><span class="o">.</span><span class="n">crawlable_list_feed</span><span class="p">(</span><span class="n">list_name</span><span class="p">)</span></div>

<div class="viewcode-block" id="crawlable_collection_feed"><a class="viewcode-back" href="../../api.html#api.routes.crawlable_collection_feed">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/collections/&lt;collection_name&gt;/crawlable&#39;</span><span class="p">)</span>
<span class="nd">@allows_patron_web</span>
<span class="nd">@returns_problem_detail</span>
<span class="nd">@compressible</span>
<span class="k">def</span> <span class="nf">crawlable_collection_feed</span><span class="p">(</span><span class="n">collection_name</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">app</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">opds_feeds</span><span class="o">.</span><span class="n">crawlable_collection_feed</span><span class="p">(</span><span class="n">collection_name</span><span class="p">)</span></div>

<div class="viewcode-block" id="shared_collection_info"><a class="viewcode-back" href="../../api.html#api.routes.shared_collection_info">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/collections/&lt;collection_name&gt;&quot;</span><span class="p">)</span>
<span class="nd">@returns_problem_detail</span>
<span class="k">def</span> <span class="nf">shared_collection_info</span><span class="p">(</span><span class="n">collection_name</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">app</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">shared_collection_controller</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">collection_name</span><span class="p">)</span></div>

<div class="viewcode-block" id="shared_collection_register"><a class="viewcode-back" href="../../api.html#api.routes.shared_collection_register">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/collections/&lt;collection_name&gt;/register&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;POST&quot;</span><span class="p">])</span>
<span class="nd">@returns_problem_detail</span>
<span class="k">def</span> <span class="nf">shared_collection_register</span><span class="p">(</span><span class="n">collection_name</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">app</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">shared_collection_controller</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">collection_name</span><span class="p">)</span></div>

<div class="viewcode-block" id="shared_collection_borrow"><a class="viewcode-back" href="../../api.html#api.routes.shared_collection_borrow">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/collections/&lt;collection_name&gt;/&lt;identifier_type&gt;/&lt;path:identifier&gt;/borrow&quot;</span><span class="p">,</span>
           <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">],</span> <span class="n">defaults</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">hold_id</span><span class="o">=</span><span class="kc">None</span><span class="p">))</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/collections/&lt;collection_name&gt;/holds/&lt;hold_id&gt;/borrow&quot;</span><span class="p">,</span>
           <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">],</span> <span class="n">defaults</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">identifier_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">identifier</span><span class="o">=</span><span class="kc">None</span><span class="p">))</span>
<span class="nd">@returns_problem_detail</span>
<span class="k">def</span> <span class="nf">shared_collection_borrow</span><span class="p">(</span><span class="n">collection_name</span><span class="p">,</span> <span class="n">identifier_type</span><span class="p">,</span> <span class="n">identifier</span><span class="p">,</span> <span class="n">hold_id</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">app</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">shared_collection_controller</span><span class="o">.</span><span class="n">borrow</span><span class="p">(</span><span class="n">collection_name</span><span class="p">,</span> <span class="n">identifier_type</span><span class="p">,</span> <span class="n">identifier</span><span class="p">,</span> <span class="n">hold_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="shared_collection_loan_info"><a class="viewcode-back" href="../../api.html#api.routes.shared_collection_loan_info">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/collections/&lt;collection_name&gt;/loans/&lt;loan_id&gt;&quot;</span><span class="p">)</span>
<span class="nd">@returns_problem_detail</span>
<span class="k">def</span> <span class="nf">shared_collection_loan_info</span><span class="p">(</span><span class="n">collection_name</span><span class="p">,</span> <span class="n">loan_id</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">app</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">shared_collection_controller</span><span class="o">.</span><span class="n">loan_info</span><span class="p">(</span><span class="n">collection_name</span><span class="p">,</span> <span class="n">loan_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="shared_collection_revoke_loan"><a class="viewcode-back" href="../../api.html#api.routes.shared_collection_revoke_loan">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/collections/&lt;collection_name&gt;/loans/&lt;loan_id&gt;/revoke&quot;</span><span class="p">)</span>
<span class="nd">@returns_problem_detail</span>
<span class="k">def</span> <span class="nf">shared_collection_revoke_loan</span><span class="p">(</span><span class="n">collection_name</span><span class="p">,</span> <span class="n">loan_id</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">app</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">shared_collection_controller</span><span class="o">.</span><span class="n">revoke_loan</span><span class="p">(</span><span class="n">collection_name</span><span class="p">,</span> <span class="n">loan_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="shared_collection_fulfill"><a class="viewcode-back" href="../../api.html#api.routes.shared_collection_fulfill">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/collections/&lt;collection_name&gt;/loans/&lt;loan_id&gt;/fulfill&quot;</span><span class="p">,</span> <span class="n">defaults</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">mechanism_id</span><span class="o">=</span><span class="kc">None</span><span class="p">))</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/collections/&lt;collection_name&gt;/loans/&lt;loan_id&gt;/fulfill/&lt;mechanism_id&gt;&quot;</span><span class="p">)</span>
<span class="nd">@returns_problem_detail</span>
<span class="k">def</span> <span class="nf">shared_collection_fulfill</span><span class="p">(</span><span class="n">collection_name</span><span class="p">,</span> <span class="n">loan_id</span><span class="p">,</span> <span class="n">mechanism_id</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">app</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">shared_collection_controller</span><span class="o">.</span><span class="n">fulfill</span><span class="p">(</span><span class="n">collection_name</span><span class="p">,</span> <span class="n">loan_id</span><span class="p">,</span> <span class="n">mechanism_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="shared_collection_hold_info"><a class="viewcode-back" href="../../api.html#api.routes.shared_collection_hold_info">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/collections/&lt;collection_name&gt;/holds/&lt;hold_id&gt;&quot;</span><span class="p">)</span>
<span class="nd">@returns_problem_detail</span>
<span class="k">def</span> <span class="nf">shared_collection_hold_info</span><span class="p">(</span><span class="n">collection_name</span><span class="p">,</span> <span class="n">hold_id</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">app</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">shared_collection_controller</span><span class="o">.</span><span class="n">hold_info</span><span class="p">(</span><span class="n">collection_name</span><span class="p">,</span> <span class="n">hold_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="shared_collection_revoke_hold"><a class="viewcode-back" href="../../api.html#api.routes.shared_collection_revoke_hold">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/collections/&lt;collection_name&gt;/holds/&lt;hold_id&gt;/revoke&quot;</span><span class="p">)</span>
<span class="nd">@returns_problem_detail</span>
<span class="k">def</span> <span class="nf">shared_collection_revoke_hold</span><span class="p">(</span><span class="n">collection_name</span><span class="p">,</span> <span class="n">hold_id</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">app</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">shared_collection_controller</span><span class="o">.</span><span class="n">revoke_hold</span><span class="p">(</span><span class="n">collection_name</span><span class="p">,</span> <span class="n">hold_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="marc_page"><a class="viewcode-back" href="../../api.html#api.routes.marc_page">[docs]</a><span class="nd">@library_route</span><span class="p">(</span><span class="s1">&#39;/marc&#39;</span><span class="p">)</span>
<span class="nd">@has_library</span>
<span class="nd">@returns_problem_detail</span>
<span class="nd">@compressible</span>
<span class="k">def</span> <span class="nf">marc_page</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">app</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">marc_records</span><span class="o">.</span><span class="n">download_page</span><span class="p">()</span></div>

<div class="viewcode-block" id="lane_search"><a class="viewcode-back" href="../../api.html#api.routes.lane_search">[docs]</a><span class="nd">@library_dir_route</span><span class="p">(</span><span class="s1">&#39;/search&#39;</span><span class="p">,</span> <span class="n">defaults</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">lane_identifier</span><span class="o">=</span><span class="kc">None</span><span class="p">))</span>
<span class="nd">@library_route</span><span class="p">(</span><span class="s1">&#39;/search/&lt;lane_identifier&gt;&#39;</span><span class="p">)</span>
<span class="nd">@has_library</span>
<span class="nd">@allows_patron_web</span>
<span class="nd">@returns_problem_detail</span>
<span class="nd">@compressible</span>
<span class="k">def</span> <span class="nf">lane_search</span><span class="p">(</span><span class="n">lane_identifier</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">app</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">opds_feeds</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">lane_identifier</span><span class="p">)</span></div>

<div class="viewcode-block" id="patron_profile"><a class="viewcode-back" href="../../api.html#api.routes.patron_profile">[docs]</a><span class="nd">@library_dir_route</span><span class="p">(</span><span class="s1">&#39;/patrons/me&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;PUT&#39;</span><span class="p">])</span>
<span class="nd">@has_library</span>
<span class="nd">@allows_patron_web</span>
<span class="nd">@requires_auth</span>
<span class="nd">@returns_problem_detail</span>
<span class="k">def</span> <span class="nf">patron_profile</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">app</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">profiles</span><span class="o">.</span><span class="n">protocol</span><span class="p">()</span></div>

<div class="viewcode-block" id="active_loans"><a class="viewcode-back" href="../../api.html#api.routes.active_loans">[docs]</a><span class="nd">@library_dir_route</span><span class="p">(</span><span class="s1">&#39;/loans&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;HEAD&#39;</span><span class="p">])</span>
<span class="nd">@has_library</span>
<span class="nd">@allows_patron_web</span>
<span class="nd">@requires_auth</span>
<span class="nd">@returns_problem_detail</span>
<span class="nd">@compressible</span>
<span class="k">def</span> <span class="nf">active_loans</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">app</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">loans</span><span class="o">.</span><span class="n">sync</span><span class="p">()</span></div>

<div class="viewcode-block" id="annotations"><a class="viewcode-back" href="../../api.html#api.routes.annotations">[docs]</a><span class="nd">@library_route</span><span class="p">(</span><span class="s1">&#39;/annotations/&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;HEAD&#39;</span><span class="p">,</span> <span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="nd">@has_library</span>
<span class="nd">@allows_patron_web</span>
<span class="nd">@requires_auth</span>
<span class="nd">@returns_problem_detail</span>
<span class="nd">@compressible</span>
<span class="k">def</span> <span class="nf">annotations</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">app</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">annotations</span><span class="o">.</span><span class="n">container</span><span class="p">()</span></div>

<div class="viewcode-block" id="annotation_detail"><a class="viewcode-back" href="../../api.html#api.routes.annotation_detail">[docs]</a><span class="nd">@library_route</span><span class="p">(</span><span class="s1">&#39;/annotations/&lt;annotation_id&gt;&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;HEAD&#39;</span><span class="p">,</span> <span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;DELETE&#39;</span><span class="p">])</span>
<span class="nd">@has_library</span>
<span class="nd">@allows_patron_web</span>
<span class="nd">@requires_auth</span>
<span class="nd">@returns_problem_detail</span>
<span class="nd">@compressible</span>
<span class="k">def</span> <span class="nf">annotation_detail</span><span class="p">(</span><span class="n">annotation_id</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">app</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">annotations</span><span class="o">.</span><span class="n">detail</span><span class="p">(</span><span class="n">annotation_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="annotations_for_work"><a class="viewcode-back" href="../../api.html#api.routes.annotations_for_work">[docs]</a><span class="nd">@library_route</span><span class="p">(</span><span class="s1">&#39;/annotations/&lt;identifier_type&gt;/&lt;path:identifier&gt;&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="nd">@has_library</span>
<span class="nd">@allows_patron_web</span>
<span class="nd">@requires_auth</span>
<span class="nd">@returns_problem_detail</span>
<span class="nd">@compressible</span>
<span class="k">def</span> <span class="nf">annotations_for_work</span><span class="p">(</span><span class="n">identifier_type</span><span class="p">,</span> <span class="n">identifier</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">app</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">annotations</span><span class="o">.</span><span class="n">container_for_work</span><span class="p">(</span><span class="n">identifier_type</span><span class="p">,</span> <span class="n">identifier</span><span class="p">)</span></div>

<div class="viewcode-block" id="borrow"><a class="viewcode-back" href="../../api.html#api.routes.borrow">[docs]</a><span class="nd">@library_route</span><span class="p">(</span><span class="s1">&#39;/works/&lt;identifier_type&gt;/&lt;path:identifier&gt;/borrow&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;PUT&#39;</span><span class="p">])</span>
<span class="nd">@library_route</span><span class="p">(</span><span class="s1">&#39;/works/&lt;identifier_type&gt;/&lt;path:identifier&gt;/borrow/&lt;mechanism_id&gt;&#39;</span><span class="p">,</span>
           <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;PUT&#39;</span><span class="p">])</span>
<span class="nd">@has_library</span>
<span class="nd">@allows_patron_web</span>
<span class="nd">@requires_auth</span>
<span class="nd">@returns_problem_detail</span>
<span class="k">def</span> <span class="nf">borrow</span><span class="p">(</span><span class="n">identifier_type</span><span class="p">,</span> <span class="n">identifier</span><span class="p">,</span> <span class="n">mechanism_id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">app</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">loans</span><span class="o">.</span><span class="n">borrow</span><span class="p">(</span><span class="n">identifier_type</span><span class="p">,</span> <span class="n">identifier</span><span class="p">,</span> <span class="n">mechanism_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="proxy_rbdigital_patron_requests"><a class="viewcode-back" href="../../api.html#api.routes.proxy_rbdigital_patron_requests">[docs]</a><span class="nd">@library_route</span><span class="p">(</span><span class="s1">&#39;/works/&lt;license_pool_id&gt;/fulfill/&lt;mechanism_id&gt;/&lt;part&gt;/rbdproxy/&lt;bearer&gt;&#39;</span><span class="p">)</span>
<span class="nd">@has_library</span>
<span class="k">def</span> <span class="nf">proxy_rbdigital_patron_requests</span><span class="p">(</span><span class="n">license_pool_id</span><span class="p">,</span> <span class="n">mechanism_id</span><span class="p">,</span> <span class="n">part</span><span class="p">,</span> <span class="n">bearer</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">app</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">rbdproxy</span><span class="o">.</span><span class="n">proxy</span><span class="p">(</span><span class="n">bearer</span><span class="p">)</span></div>

<div class="viewcode-block" id="fulfill"><a class="viewcode-back" href="../../api.html#api.routes.fulfill">[docs]</a><span class="nd">@library_route</span><span class="p">(</span><span class="s1">&#39;/works/&lt;license_pool_id&gt;/fulfill&#39;</span><span class="p">)</span>
<span class="nd">@library_route</span><span class="p">(</span><span class="s1">&#39;/works/&lt;license_pool_id&gt;/fulfill/&lt;mechanism_id&gt;&#39;</span><span class="p">)</span>
<span class="nd">@library_route</span><span class="p">(</span><span class="s1">&#39;/works/&lt;license_pool_id&gt;/fulfill/&lt;mechanism_id&gt;/&lt;part&gt;&#39;</span><span class="p">)</span>
<span class="nd">@has_library</span>
<span class="nd">@allows_patron_web</span>
<span class="nd">@returns_problem_detail</span>
<span class="k">def</span> <span class="nf">fulfill</span><span class="p">(</span><span class="n">license_pool_id</span><span class="p">,</span> <span class="n">mechanism_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">part</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">app</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">loans</span><span class="o">.</span><span class="n">fulfill</span><span class="p">(</span><span class="n">license_pool_id</span><span class="p">,</span> <span class="n">mechanism_id</span><span class="p">,</span> <span class="n">part</span><span class="p">)</span></div>

<div class="viewcode-block" id="revoke_loan_or_hold"><a class="viewcode-back" href="../../api.html#api.routes.revoke_loan_or_hold">[docs]</a><span class="nd">@library_route</span><span class="p">(</span><span class="s1">&#39;/loans/&lt;license_pool_id&gt;/revoke&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;PUT&#39;</span><span class="p">])</span>
<span class="nd">@has_library</span>
<span class="nd">@allows_patron_web</span>
<span class="nd">@requires_auth</span>
<span class="nd">@returns_problem_detail</span>
<span class="k">def</span> <span class="nf">revoke_loan_or_hold</span><span class="p">(</span><span class="n">license_pool_id</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">app</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">loans</span><span class="o">.</span><span class="n">revoke</span><span class="p">(</span><span class="n">license_pool_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="loan_or_hold_detail"><a class="viewcode-back" href="../../api.html#api.routes.loan_or_hold_detail">[docs]</a><span class="nd">@library_route</span><span class="p">(</span><span class="s1">&#39;/loans/&lt;identifier_type&gt;/&lt;path:identifier&gt;&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;DELETE&#39;</span><span class="p">])</span>
<span class="nd">@has_library</span>
<span class="nd">@allows_patron_web</span>
<span class="nd">@requires_auth</span>
<span class="nd">@returns_problem_detail</span>
<span class="k">def</span> <span class="nf">loan_or_hold_detail</span><span class="p">(</span><span class="n">identifier_type</span><span class="p">,</span> <span class="n">identifier</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">app</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">loans</span><span class="o">.</span><span class="n">detail</span><span class="p">(</span><span class="n">identifier_type</span><span class="p">,</span> <span class="n">identifier</span><span class="p">)</span></div>

<div class="viewcode-block" id="work"><a class="viewcode-back" href="../../api.html#api.routes.work">[docs]</a><span class="nd">@library_dir_route</span><span class="p">(</span><span class="s1">&#39;/works&#39;</span><span class="p">)</span>
<span class="nd">@has_library</span>
<span class="nd">@allows_patron_web</span>
<span class="nd">@returns_problem_detail</span>
<span class="nd">@compressible</span>
<span class="k">def</span> <span class="nf">work</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">app</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">urn_lookup</span><span class="o">.</span><span class="n">work_lookup</span><span class="p">(</span><span class="s1">&#39;work&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="contributor"><a class="viewcode-back" href="../../api.html#api.routes.contributor">[docs]</a><span class="nd">@library_dir_route</span><span class="p">(</span><span class="s1">&#39;/works/contributor/&lt;contributor_name&gt;&#39;</span><span class="p">,</span> <span class="n">defaults</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">languages</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">audiences</span><span class="o">=</span><span class="kc">None</span><span class="p">))</span>
<span class="nd">@library_dir_route</span><span class="p">(</span><span class="s1">&#39;/works/contributor/&lt;contributor_name&gt;/&lt;languages&gt;&#39;</span><span class="p">,</span> <span class="n">defaults</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">audiences</span><span class="o">=</span><span class="kc">None</span><span class="p">))</span>
<span class="nd">@library_route</span><span class="p">(</span><span class="s1">&#39;/works/contributor/&lt;contributor_name&gt;/&lt;languages&gt;/&lt;audiences&gt;&#39;</span><span class="p">)</span>
<span class="nd">@has_library</span>
<span class="nd">@allows_patron_web</span>
<span class="nd">@returns_problem_detail</span>
<span class="nd">@compressible</span>
<span class="k">def</span> <span class="nf">contributor</span><span class="p">(</span><span class="n">contributor_name</span><span class="p">,</span> <span class="n">languages</span><span class="p">,</span> <span class="n">audiences</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">app</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">work_controller</span><span class="o">.</span><span class="n">contributor</span><span class="p">(</span><span class="n">contributor_name</span><span class="p">,</span> <span class="n">languages</span><span class="p">,</span> <span class="n">audiences</span><span class="p">)</span></div>

<div class="viewcode-block" id="series"><a class="viewcode-back" href="../../api.html#api.routes.series">[docs]</a><span class="nd">@library_dir_route</span><span class="p">(</span><span class="s1">&#39;/works/series/&lt;series_name&gt;&#39;</span><span class="p">,</span> <span class="n">defaults</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">languages</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">audiences</span><span class="o">=</span><span class="kc">None</span><span class="p">))</span>
<span class="nd">@library_dir_route</span><span class="p">(</span><span class="s1">&#39;/works/series/&lt;series_name&gt;/&lt;languages&gt;&#39;</span><span class="p">,</span> <span class="n">defaults</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">audiences</span><span class="o">=</span><span class="kc">None</span><span class="p">))</span>
<span class="nd">@library_route</span><span class="p">(</span><span class="s1">&#39;/works/series/&lt;series_name&gt;/&lt;languages&gt;/&lt;audiences&gt;&#39;</span><span class="p">)</span>
<span class="nd">@has_library</span>
<span class="nd">@allows_patron_web</span>
<span class="nd">@returns_problem_detail</span>
<span class="nd">@compressible</span>
<span class="k">def</span> <span class="nf">series</span><span class="p">(</span><span class="n">series_name</span><span class="p">,</span> <span class="n">languages</span><span class="p">,</span> <span class="n">audiences</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">app</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">work_controller</span><span class="o">.</span><span class="n">series</span><span class="p">(</span><span class="n">series_name</span><span class="p">,</span> <span class="n">languages</span><span class="p">,</span> <span class="n">audiences</span><span class="p">)</span></div>

<div class="viewcode-block" id="permalink"><a class="viewcode-back" href="../../api.html#api.routes.permalink">[docs]</a><span class="nd">@library_route</span><span class="p">(</span><span class="s1">&#39;/works/&lt;identifier_type&gt;/&lt;path:identifier&gt;&#39;</span><span class="p">)</span>
<span class="nd">@has_library</span>
<span class="nd">@allows_patron_web</span>
<span class="nd">@returns_problem_detail</span>
<span class="nd">@compressible</span>
<span class="k">def</span> <span class="nf">permalink</span><span class="p">(</span><span class="n">identifier_type</span><span class="p">,</span> <span class="n">identifier</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">app</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">work_controller</span><span class="o">.</span><span class="n">permalink</span><span class="p">(</span><span class="n">identifier_type</span><span class="p">,</span> <span class="n">identifier</span><span class="p">)</span></div>

<div class="viewcode-block" id="recommendations"><a class="viewcode-back" href="../../api.html#api.routes.recommendations">[docs]</a><span class="nd">@library_route</span><span class="p">(</span><span class="s1">&#39;/works/&lt;identifier_type&gt;/&lt;path:identifier&gt;/recommendations&#39;</span><span class="p">)</span>
<span class="nd">@has_library</span>
<span class="nd">@allows_patron_web</span>
<span class="nd">@returns_problem_detail</span>
<span class="nd">@compressible</span>
<span class="k">def</span> <span class="nf">recommendations</span><span class="p">(</span><span class="n">identifier_type</span><span class="p">,</span> <span class="n">identifier</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">app</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">work_controller</span><span class="o">.</span><span class="n">recommendations</span><span class="p">(</span><span class="n">identifier_type</span><span class="p">,</span> <span class="n">identifier</span><span class="p">)</span></div>

<div class="viewcode-block" id="related_books"><a class="viewcode-back" href="../../api.html#api.routes.related_books">[docs]</a><span class="nd">@library_route</span><span class="p">(</span><span class="s1">&#39;/works/&lt;identifier_type&gt;/&lt;path:identifier&gt;/related_books&#39;</span><span class="p">)</span>
<span class="nd">@has_library</span>
<span class="nd">@allows_patron_web</span>
<span class="nd">@returns_problem_detail</span>
<span class="nd">@compressible</span>
<span class="k">def</span> <span class="nf">related_books</span><span class="p">(</span><span class="n">identifier_type</span><span class="p">,</span> <span class="n">identifier</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">app</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">work_controller</span><span class="o">.</span><span class="n">related</span><span class="p">(</span><span class="n">identifier_type</span><span class="p">,</span> <span class="n">identifier</span><span class="p">)</span></div>

<div class="viewcode-block" id="report"><a class="viewcode-back" href="../../api.html#api.routes.report">[docs]</a><span class="nd">@library_route</span><span class="p">(</span><span class="s1">&#39;/works/&lt;identifier_type&gt;/&lt;path:identifier&gt;/report&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="nd">@has_library</span>
<span class="nd">@allows_patron_web</span>
<span class="nd">@returns_problem_detail</span>
<span class="k">def</span> <span class="nf">report</span><span class="p">(</span><span class="n">identifier_type</span><span class="p">,</span> <span class="n">identifier</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">app</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">work_controller</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="n">identifier_type</span><span class="p">,</span> <span class="n">identifier</span><span class="p">)</span></div>

<div class="viewcode-block" id="track_analytics_event"><a class="viewcode-back" href="../../api.html#api.routes.track_analytics_event">[docs]</a><span class="nd">@library_route</span><span class="p">(</span><span class="s1">&#39;/analytics/&lt;identifier_type&gt;/&lt;path:identifier&gt;/&lt;event_type&gt;&#39;</span><span class="p">)</span>
<span class="nd">@has_library</span>
<span class="nd">@allows_auth</span>
<span class="nd">@allows_patron_web</span>
<span class="nd">@returns_problem_detail</span>
<span class="k">def</span> <span class="nf">track_analytics_event</span><span class="p">(</span><span class="n">identifier_type</span><span class="p">,</span> <span class="n">identifier</span><span class="p">,</span> <span class="n">event_type</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">app</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">analytics_controller</span><span class="o">.</span><span class="n">track_event</span><span class="p">(</span><span class="n">identifier_type</span><span class="p">,</span> <span class="n">identifier</span><span class="p">,</span> <span class="n">event_type</span><span class="p">)</span></div>

<span class="c1"># Adobe Vendor ID implementation</span>
<div class="viewcode-block" id="adobe_vendor_id_get_token"><a class="viewcode-back" href="../../api.html#api.routes.adobe_vendor_id_get_token">[docs]</a><span class="nd">@library_route</span><span class="p">(</span><span class="s1">&#39;/AdobeAuth/authdata&#39;</span><span class="p">)</span>
<span class="nd">@has_library</span>
<span class="nd">@requires_auth</span>
<span class="nd">@returns_problem_detail</span>
<span class="k">def</span> <span class="nf">adobe_vendor_id_get_token</span><span class="p">():</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">app</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">adobe_vendor_id</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">REMOTE_INTEGRATION_FAILED</span><span class="o">.</span><span class="n">detailed</span><span class="p">(</span>
            <span class="n">_</span><span class="p">(</span><span class="s2">&quot;This server does not have an Adobe Vendor ID server configured.&quot;</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">app</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">adobe_vendor_id</span><span class="o">.</span><span class="n">create_authdata_handler</span><span class="p">(</span><span class="n">flask</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">patron</span><span class="p">)</span></div>

<div class="viewcode-block" id="adobe_vendor_id_signin"><a class="viewcode-back" href="../../api.html#api.routes.adobe_vendor_id_signin">[docs]</a><span class="nd">@library_route</span><span class="p">(</span><span class="s1">&#39;/AdobeAuth/SignIn&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="nd">@has_library</span>
<span class="nd">@returns_problem_detail</span>
<span class="k">def</span> <span class="nf">adobe_vendor_id_signin</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">app</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">adobe_vendor_id</span><span class="o">.</span><span class="n">signin_handler</span><span class="p">()</span></div>

<div class="viewcode-block" id="adobe_vendor_id_accountinfo"><a class="viewcode-back" href="../../api.html#api.routes.adobe_vendor_id_accountinfo">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/AdobeAuth/AccountInfo&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="nd">@returns_problem_detail</span>
<span class="k">def</span> <span class="nf">adobe_vendor_id_accountinfo</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">app</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">adobe_vendor_id</span><span class="o">.</span><span class="n">userinfo_handler</span><span class="p">()</span></div>

<div class="viewcode-block" id="adobe_vendor_id_status"><a class="viewcode-back" href="../../api.html#api.routes.adobe_vendor_id_status">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/AdobeAuth/Status&#39;</span><span class="p">)</span>
<span class="nd">@returns_problem_detail</span>
<span class="k">def</span> <span class="nf">adobe_vendor_id_status</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">app</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">adobe_vendor_id</span><span class="o">.</span><span class="n">status_handler</span><span class="p">()</span></div>

<span class="c1"># DRM Device Management Protocol implementation for ACS.</span>
<div class="viewcode-block" id="adobe_drm_devices"><a class="viewcode-back" href="../../api.html#api.routes.adobe_drm_devices">[docs]</a><span class="nd">@library_route</span><span class="p">(</span><span class="s1">&#39;/AdobeAuth/devices&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="nd">@has_library</span>
<span class="nd">@requires_auth</span>
<span class="nd">@returns_problem_detail</span>
<span class="k">def</span> <span class="nf">adobe_drm_devices</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">app</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">adobe_device_management</span><span class="o">.</span><span class="n">device_id_list_handler</span><span class="p">()</span></div>

<div class="viewcode-block" id="adobe_drm_device"><a class="viewcode-back" href="../../api.html#api.routes.adobe_drm_device">[docs]</a><span class="nd">@library_route</span><span class="p">(</span><span class="s1">&#39;/AdobeAuth/devices/&lt;device_id&gt;&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;DELETE&#39;</span><span class="p">])</span>
<span class="nd">@has_library</span>
<span class="nd">@requires_auth</span>
<span class="nd">@returns_problem_detail</span>
<span class="k">def</span> <span class="nf">adobe_drm_device</span><span class="p">(</span><span class="n">device_id</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">app</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">adobe_device_management</span><span class="o">.</span><span class="n">device_id_handler</span><span class="p">(</span><span class="n">device_id</span><span class="p">)</span></div>

<span class="c1"># Route that redirects to the authentication URL for an OAuth provider</span>
<div class="viewcode-block" id="oauth_authenticate"><a class="viewcode-back" href="../../api.html#api.routes.oauth_authenticate">[docs]</a><span class="nd">@library_route</span><span class="p">(</span><span class="s1">&#39;/oauth_authenticate&#39;</span><span class="p">)</span>
<span class="nd">@has_library</span>
<span class="nd">@returns_problem_detail</span>
<span class="k">def</span> <span class="nf">oauth_authenticate</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">app</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">oauth_controller</span><span class="o">.</span><span class="n">oauth_authentication_redirect</span><span class="p">(</span><span class="n">flask</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="n">app</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">_db</span><span class="p">)</span></div>

<span class="c1"># Redirect URI for OAuth providers, eg. Clever</span>
<div class="viewcode-block" id="oauth_callback"><a class="viewcode-back" href="../../api.html#api.routes.oauth_callback">[docs]</a><span class="nd">@library_route</span><span class="p">(</span><span class="s1">&#39;/oauth_callback&#39;</span><span class="p">)</span>
<span class="nd">@has_library</span>
<span class="nd">@returns_problem_detail</span>
<span class="k">def</span> <span class="nf">oauth_callback</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">app</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">oauth_controller</span><span class="o">.</span><span class="n">oauth_authentication_callback</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">_db</span><span class="p">,</span> <span class="n">flask</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">)</span></div>

<span class="c1"># Route that redirects to the authentication URL for a SAML provider</span>
<div class="viewcode-block" id="saml_authenticate"><a class="viewcode-back" href="../../api.html#api.routes.saml_authenticate">[docs]</a><span class="nd">@library_route</span><span class="p">(</span><span class="s1">&#39;/saml_authenticate&#39;</span><span class="p">)</span>
<span class="nd">@has_library</span>
<span class="nd">@returns_problem_detail</span>
<span class="k">def</span> <span class="nf">saml_authenticate</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">app</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">saml_controller</span><span class="o">.</span><span class="n">saml_authentication_redirect</span><span class="p">(</span><span class="n">flask</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="n">app</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">_db</span><span class="p">)</span></div>

<span class="c1"># Redirect URI for SAML providers</span>
<span class="c1"># NOTE: we cannot use @has_library decorator and append a library&#39;s name to saml_calback route</span>
<span class="c1"># (e.g. https://cm.org/LIBRARY_NAME/saml_callback).</span>
<span class="c1"># The URL of the SP&#39;s assertion consumer service (saml_callback) should be constant:</span>
<span class="c1"># SP&#39;s metadata is registered in the IdP and cannot change.</span>
<span class="c1"># If we try to append a library&#39;s name to the ACS&#39;s URL sent as a part of the SAML request,</span>
<span class="c1"># the IdP will fail this request because the URL mentioned in the request and</span>
<span class="c1"># the URL saved in the SP&#39;s metadata configured in this IdP will differ.</span>
<span class="c1"># Library&#39;s name is passed as a part of the relay state and processed in SAMLController.saml_authentication_callback</span>
<div class="viewcode-block" id="saml_callback"><a class="viewcode-back" href="../../api.html#api.routes.saml_callback">[docs]</a><span class="nd">@returns_problem_detail</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/saml_callback&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">saml_callback</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">app</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">saml_controller</span><span class="o">.</span><span class="n">saml_authentication_callback</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">app</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">_db</span><span class="p">)</span></div>


<div class="viewcode-block" id="lcp_passphrase"><a class="viewcode-back" href="../../api.html#api.routes.lcp_passphrase">[docs]</a><span class="nd">@library_route</span><span class="p">(</span><span class="s1">&#39;/lcp/hint&#39;</span><span class="p">)</span>
<span class="nd">@has_library</span>
<span class="nd">@requires_auth</span>
<span class="nd">@returns_problem_detail</span>
<span class="k">def</span> <span class="nf">lcp_passphrase</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">app</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">lcp_controller</span><span class="o">.</span><span class="n">get_lcp_passphrase</span><span class="p">()</span></div>


<div class="viewcode-block" id="lcp_license"><a class="viewcode-back" href="../../api.html#api.routes.lcp_license">[docs]</a><span class="nd">@library_route</span><span class="p">(</span><span class="s1">&#39;/lcp/licenses/&lt;license_id&gt;&#39;</span><span class="p">)</span>
<span class="nd">@has_library</span>
<span class="nd">@requires_auth</span>
<span class="nd">@returns_problem_detail</span>
<span class="k">def</span> <span class="nf">lcp_license</span><span class="p">(</span><span class="n">license_id</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">app</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">lcp_controller</span><span class="o">.</span><span class="n">get_lcp_license</span><span class="p">(</span><span class="n">license_id</span><span class="p">)</span></div>

<span class="c1"># Loan notifications for ODL distributors, eg. Feedbooks</span>
<div class="viewcode-block" id="odl_notify"><a class="viewcode-back" href="../../api.html#api.routes.odl_notify">[docs]</a><span class="nd">@library_route</span><span class="p">(</span><span class="s1">&#39;/odl_notify/&lt;loan_id&gt;&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="nd">@has_library</span>
<span class="nd">@returns_problem_detail</span>
<span class="k">def</span> <span class="nf">odl_notify</span><span class="p">(</span><span class="n">loan_id</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">app</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">odl_notification_controller</span><span class="o">.</span><span class="n">notify</span><span class="p">(</span><span class="n">loan_id</span><span class="p">)</span></div>

<span class="c1"># Controllers used for operations purposes</span>
<div class="viewcode-block" id="heartbeat"><a class="viewcode-back" href="../../api.html#api.routes.heartbeat">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/heartbeat&#39;</span><span class="p">)</span>
<span class="nd">@returns_problem_detail</span>
<span class="k">def</span> <span class="nf">heartbeat</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">app</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">heartbeat</span><span class="o">.</span><span class="n">heartbeat</span><span class="p">()</span></div>

<div class="viewcode-block" id="health_check"><a class="viewcode-back" href="../../api.html#api.routes.health_check">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/healthcheck.html&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">health_check</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span></div>

<div class="viewcode-block" id="static_image"><a class="viewcode-back" href="../../api.html#api.routes.static_image">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/images/&lt;filename&gt;&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">static_image</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">app</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">static_files</span><span class="o">.</span><span class="n">image</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span></div>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">Library Simplified Circulation Manager</a></h1>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">circulation</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, The New York Public Library, Astor, Lenox, and Tilden Foundations.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>